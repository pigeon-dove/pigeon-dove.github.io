<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="java,前端,python,AI"><meta name="author" content="布鸽不鸽"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://evan.beee.top" crossorigin><link rel="canonical" href="https://xuedongyun.cn/post/26216/"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="revisit-after" content="1 days"><meta name="description" content="前言本文是Redis基础学习笔记 原文地址：https:&#x2F;&#x2F;xuedongyun.cn&#x2F;post&#x2F;26216&#x2F; Redis入门概述是什么 Remote Dictionary Server，远程字典服务器  基于内存的，k-v键值对（一种NoSQL）数据库  相关网站  作者博客（有一些更新日志）：http:&#x2F;&#x2F;antirez.com  Github仓库：https:&#x2F;&#x2F;github.com&#x2F;red"><meta property="og:type" content="article"><meta property="og:title" content="Redis基础"><meta property="og:url" content="https://xuedongyun.cn/post/26216/index.html"><meta property="og:site_name" content="冬云的博客"><meta property="og:description" content="前言本文是Redis基础学习笔记 原文地址：https:&#x2F;&#x2F;xuedongyun.cn&#x2F;post&#x2F;26216&#x2F; Redis入门概述是什么 Remote Dictionary Server，远程字典服务器  基于内存的，k-v键值对（一种NoSQL）数据库  相关网站  作者博客（有一些更新日志）：http:&#x2F;&#x2F;antirez.com  Github仓库：https:&#x2F;&#x2F;github.com&#x2F;red"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2023-08-28T10:44:58.000Z"><meta property="article:modified_time" content="2023-08-28T10:46:36.000Z"><meta property="article:author" content="布鸽不鸽"><meta property="article:tag" content="java,前端,python,AI"><meta name="twitter:card" content="summary"><link rel="icon" type="image/png" href="/image/favicon.ico" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/image/favicon.ico"><meta name="theme-color" content="#A31F34"><link rel="shortcut icon" href="/image/favicon.ico"><title>Redis基础 | 冬云的博客</title><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/fonts/Chillax/chillax.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/assets/build/styles.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/fonts/GeistMono/geist-mono.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/fonts/Geist/geist.css"><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/libs/anime.min.js"></script><script id="hexo-configurations">window.config={hostname:"xuedongyun.cn",root:"/",language:"zh-CN",path:"search.xml"},window.theme={articles:{style:{font_size:"16px",line_height:1.5,image_border_radius:"14px",image_alignment:"center",image_caption:!1,link_icon:!0,title_alignment:"left",headings_top_spacing:{h1:"3.2rem",h2:"2.4rem",h3:"1.9rem",h4:"1.6rem",h5:"1.4rem",h6:"1.3rem"}},word_count:{enable:!0,count:!0,min2read:!0},author_label:{enable:!0,auto:!1,list:[]},code_block:{copy:!0,style:"mac",highlight_theme:{light:"github",dark:"vs2015"},font:{enable:!1,family:null,url:null}},toc:{enable:!0,max_depth:3,number:!1,expand:!0,init_open:!0},copyright:{enable:!0,default:"cc_by_nc_sa"},lazyload:!0,recommendation:{enable:!0,title:"推荐阅读",limit:3,mobile_limit:2,placeholder:"/images/wallhaven-wqery6-light.webp",skip_dirs:[]}},colors:{primary:"#A31F34",secondary:null,default_mode:"light"},global:{fonts:{chinese:{enable:!1,family:null,url:null},english:{enable:!1,family:null,url:null},title:{enable:!1,family:null,url:null}},content_max_width:"1000px",sidebar_width:"210px",hover:{shadow:!0,scale:!0},scroll_progress:{bar:!0,percentage:!0},website_counter:{url:"https://cn.vercount.one/js",enable:!0,site_pv:!0,site_uv:!0,post_pv:!0},single_page:!0,preloader:{enable:!0,custom_message:null},open_graph:!0,google_analytics:{enable:!1,id:null}},home_banner:{enable:!0,style:"fixed",image:{light:"https://s2.loli.net/2023/04/26/5keLlFDntNaz81Z.webp",dark:"https://s2.loli.net/2023/04/26/5keLlFDntNaz81Z.webp"},title:"程序员的个人修养",subtitle:{text:["Hello World!","Across the Great Wall we can reach every corner in the world"],hitokoto:{enable:!1,show_author:!1,api:"https://v1.hitokoto.cn"},typing_speed:50,backing_speed:80,starting_delay:500,backing_delay:1500,loop:!0,smart_backspace:!0},text_color:{light:"#fff",dark:"#d1d1b6"},text_style:{title_size:"2.8rem",subtitle_size:"1.5rem",line_height:1.2},custom_font:{enable:!1,family:null,url:null},social_links:{enable:!1,style:"default",links:{github:null,instagram:null,zhihu:null,twitter:null,email:null},qrs:{weixin:null}}},plugins:{feed:{enable:!1},aplayer:{enable:!0,type:"fixed",audios:[{name:"One Last Kiss",artist:"宇多田ヒカル",url:"/music/OneLastKiss.mp3",cover:"/image/OneLastKiss.webp",lrc:null},{name:"水星记",artist:"郭顶",cover:"/image/水星记.webp",url:"/music/水星记.mp3"},{name:"平凡之路",artist:"朴树",cover:"/image/平凡之路.webp",url:"/music/平凡之路.mp3"}]},mermaid:{enable:!0,version:"9.3.0"}},version:"2.7.2",navbar:{auto_hide:!1,color:{left:"#f78736",right:"#367df7",transparency:50},width:{home:"1200px",pages:"1000px"},links:{Home:{path:"/",icon:"fa-regular fa-house"},java:{path:"/categories/java/",icon:"fa-regular fa-server"},MySQL:{path:"/categories/MySQL/",icon:"fa-regular fa-hard-drive"},Redis:{path:"/categories/Redis/",icon:"fa-regular fa-memory"},MQ:{path:"/categories/MQ/",icon:"fa-regular fa-pipe-circle-check"},"算法题":{path:"/categories/算法题/",icon:"fa-regular fa-laptop-code"},"工具和应用":{path:"/categories/工具和应用/",icon:"fa-regular fa-toolbox"}},search:{enable:!0,preload:!0}},page_templates:{friends_column:2,tags_style:"blur"},home:{sidebar:{enable:!0,position:"left",first_item:"menu",announcement:"Fly Me To The Moon",show_on_mobile:!0,links:{"博客搭建系列":{path:"/tags/博客搭建系列"},"SpringBoot源码系列":{path:"/tags/SpringBoot源码系列"},"Java设计模式系列":{path:"/tags/java设计模式系列"},"Redis实战系列":{path:"/tags/Redis实战系列"}}},article_date_format:"auto",excerpt_length:200,categories:{enable:!0,limit:3},tags:{enable:!0,limit:3}},footerStart:"2022/4/19 20:56:00"},window.lang_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},window.data={masonry:!1}</script><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/fontawesome/brands.min.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/fontawesome/solid.min.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/fontawesome/regular.min.css"><meta name="generator" content="Hexo 6.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span> <span class="pjax-progress-bar"></span></div><style>:root{--preloader-background-color:#fff;--preloader-text-color:#000}@media (prefers-color-scheme:dark){:root{--preloader-background-color:#202124;--preloader-text-color:#fff}}@media (prefers-color-scheme:light){:root{--preloader-background-color:#fff;--preloader-text-color:#000}}@media (max-width:600px){.ml13{font-size:2.6rem!important}}.preloader{display:flex;flex-direction:column;gap:1rem;align-items:center;justify-content:center;position:fixed;padding:12px;top:0;right:0;bottom:0;left:0;width:100vw;height:100vh;background-color:var(--preloader-background-color);z-index:1100;transition:opacity .2s ease-in-out}.ml13{font-size:3.2rem;color:var(--preloader-text-color);letter-spacing:-1px;font-weight:500;font-family:Chillax-Variable,sans-serif;text-align:center}.ml13 .word{display:inline-flex;flex-wrap:wrap;white-space:nowrap}.ml13 .letter{display:inline-block;line-height:1em}</style><div class="preloader"><h2 class="ml13">冬云的博客</h2><script>var textWrapper = document.querySelector('.ml13');
        // Split text into words
        var words = textWrapper.textContent.trim().split(' ');

        // Clear the existing content
        textWrapper.innerHTML = '';

        // Wrap each word and its letters in spans
        words.forEach(function(word) {
            var wordSpan = document.createElement('span');
            wordSpan.classList.add('word');
            wordSpan.innerHTML = word.replace(/\S/g, "<span class='letter'>$&</span>");
            textWrapper.appendChild(wordSpan);
            textWrapper.appendChild(document.createTextNode(' ')); // Add space between words
        });

        var animation = anime.timeline({ loop: true })
            .add({
                targets: '.ml13 .letter',
                translateY: [20, 0],
                translateZ: 0,
                opacity: [0, 1],
                filter: ['blur(5px)', 'blur(0px)'],
                easing: "easeOutExpo",
                duration: 1200,
                delay: (el, i) => 300 + 20 * i,
            })
            .add({
                targets: '.ml13 .letter',
                translateY: [0, -20],
                opacity: [1, 0],
                filter: ['blur(0px)', 'blur(5px)'],
                easing: "easeInExpo",
                duration: 1000,
                delay: (el, i) => 15 * i,
                complete: function() {
                    hidePreloader();
                }
            }, '-=700');


        let themeStatus = JSON.parse(localStorage.getItem('REDEFINE-THEME-STATUS'))?.isDark;

        // If the theme status is not found in local storage, check the preferred color scheme
        if (themeStatus === undefined || themeStatus === null) {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                themeStatus = 'dark';
            } else {
                themeStatus = 'light';
            }
        }

        // Now you can use the themeStatus variable in your code
        if (themeStatus) {
            document.documentElement.style.setProperty('--preloader-background-color', '#202124');
            document.documentElement.style.setProperty('--preloader-text-color', '#fff');
        } else {
            document.documentElement.style.setProperty('--preloader-background-color', '#fff');
            document.documentElement.style.setProperty('--preloader-text-color', '#000');
        }

        window.addEventListener('load', function () {
            setTimeout(hidePreloader, 5000); // Call hidePreloader after 5000 milliseconds if not already called by animation
        });

        function hidePreloader() {
            var preloader = document.querySelector('.preloader');
            preloader.style.opacity = '0';
            setTimeout(function () {
                preloader.style.display = 'none';
            }, 200);
        }</script></div><main class="page-container" id="swup"><div class="main-content-container flex flex-col justify-between min-h-dvh"><div class="main-content-header"><header class="navbar-container px-6 md:px-12"><div class="navbar-content transition-navbar"><div class="left"><a class="logo-title" href="/">冬云的博客</a></div><div class="right"><div class="desktop"><ul class="navbar-list"><li class="navbar-item"><a href="/"><i class="fa-regular fa-house fa-fw"></i> 首页</a></li><li class="navbar-item"><a href="/categories/java/"><i class="fa-regular fa-server fa-fw"></i> JAVA</a></li><li class="navbar-item"><a href="/categories/MySQL/"><i class="fa-regular fa-hard-drive fa-fw"></i> MYSQL</a></li><li class="navbar-item"><a href="/categories/Redis/"><i class="fa-regular fa-memory fa-fw"></i> REDIS</a></li><li class="navbar-item"><a href="/categories/MQ/"><i class="fa-regular fa-pipe-circle-check fa-fw"></i> MQ</a></li><li class="navbar-item"><a href="/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"><i class="fa-regular fa-laptop-code fa-fw"></i> 算法题</a></li><li class="navbar-item"><a href="/categories/%E5%B7%A5%E5%85%B7%E5%92%8C%E5%BA%94%E7%94%A8/"><i class="fa-regular fa-toolbox fa-fw"></i> 工具和应用</a></li><li class="navbar-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div><div class="icon-item navbar-bar"><div class="navbar-bar-middle"></div></div></div></div></div><div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between"><ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start"><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/"><span>首页 </span><i class="fa-regular fa-house fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/categories/java/"><span>JAVA </span><i class="fa-regular fa-server fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/categories/MySQL/"><span>MYSQL </span><i class="fa-regular fa-hard-drive fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/categories/Redis/"><span>REDIS </span><i class="fa-regular fa-memory fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/categories/MQ/"><span>MQ </span><i class="fa-regular fa-pipe-circle-check fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/categories/%E7%AE%97%E6%B3%95%E9%A2%98/"><span>算法题 </span><i class="fa-regular fa-laptop-code fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/categories/%E5%B7%A5%E5%85%B7%E5%92%8C%E5%BA%94%E7%94%A8/"><span>工具和应用 </span><i class="fa-regular fa-toolbox fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active" href="/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E7%B3%BB%E5%88%97"><span>博客搭建系列</span> <i class="fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active" href="/tags/SpringBoot%E6%BA%90%E7%A0%81%E7%B3%BB%E5%88%97"><span>SpringBoot源码系列</span> <i class="fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active" href="/tags/java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97"><span>Java设计模式系列</span> <i class="fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active" href="/tags/Redis%E5%AE%9E%E6%88%98%E7%B3%BB%E5%88%97"><span>Redis实战系列</span> <i class="fa-sm fa-fw"></i></a></li></ul><div class="statistics flex justify-around my-2.5"><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">11</div><div class="label text-third-text-color text-sm">标签</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">17</div><div class="label text-third-text-color text-sm">分类</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">49</div><div class="label text-third-text-color text-sm">文章</div></a></div></div><div class="window-mask"></div></header></div><div class="main-content-body"><div class="main-content"><div class="post-page-container flex relative justify-between box-border w-full h-full"><div class="article-content-container"><div class="article-title relative w-full"><div class="w-full flex items-center pt-6 justify-start"><h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">Redis基础</h1></div></div><div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8"><div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]"><img src="https://s2.loli.net/2023/04/20/q9CpkwWALQae6Mj.jpg"></div><div class="info flex flex-col justify-between"><div class="author flex items-center"><span class="name text-default-text-color text-lg font-semibold">布鸽不鸽</span> <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv4</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-pen-fancy"></i>&nbsp; <span class="desktop">2023-08-28 18:44:58</span> <span class="mobile">2023-08-28 18:44:58</span> <span class="hover-info">创建</span> </span><span class="article-date article-meta-item"><i class="fa-regular fa-wrench"></i>&nbsp; <span class="desktop">2023-08-28 18:46:36</span> <span class="mobile">2023-08-28 18:46:36</span> <span class="hover-info">更新</span> </span><span class="article-categories article-meta-item"><i class="fa-regular fa-folders"></i>&nbsp;<ul><li><a href="/categories/Redis/">Redis</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fa-regular fa-typewriter"></i>&nbsp;<span>12k 字</span> </span><span class="article-min2read article-meta-item"><i class="fa-regular fa-clock"></i>&nbsp;<span>50 分钟</span> </span><span class="article-pv article-meta-item"><i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文是Redis基础学习笔记</p><p>原文地址：<a href="https://xuedongyun.cn/post/26216/">https://xuedongyun.cn/post/26216/</a></p><h2 id="Redis入门概述"><a href="#Redis入门概述" class="headerlink" title="Redis入门概述"></a>Redis入门概述</h2><h3 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h3><ul><li><p>Remote Dictionary Server，远程字典服务器</p></li><li><p>基于内存的，k-v键值对（一种NoSQL）数据库</p></li><li><p>相关网站</p><ul><li>作者博客（有一些更新日志）：<a class="link" target="_blank" rel="noopener" href="http://antirez.com/">http://antirez.com <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>Github仓库：<a class="link" target="_blank" rel="noopener" href="https://github.com/redis/redis">https://github.com/redis/redis <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>英文官网：<a class="link" target="_blank" rel="noopener" href="https://redis.io/">https://redis.io/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>中文官网：<a class="link" target="_blank" rel="noopener" href="http://redis.cn/">http://redis.cn/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>中文文档：<a class="link" target="_blank" rel="noopener" href="https://redis.com.cn/documentation.html">https://redis.com.cn/documentation.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>redis在线测试：<a class="link" target="_blank" rel="noopener" href="https://try.redis.io/">https://try.redis.io/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>redis命令手册：<a class="link" target="_blank" rel="noopener" href="http://doc.redisfans.com/">http://doc.redisfans.com/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul></li></ul><h3 id="能干什么"><a href="#能干什么" class="headerlink" title="能干什么"></a>能干什么</h3><ul><li><p>挡在<code>MySQL</code>前面的带刀护卫</p></li><li><p>内存存储和持久化（RDB+AOF）</p><ul><li><code>redis</code>支持异步将内存中的数据写到硬盘上，同时不影响继续服务</li></ul></li><li><p>高可用架构搭配</p><ul><li>单机</li><li>主从</li><li>哨兵</li><li>集群</li></ul></li><li><p>缓存穿透，击穿，雪崩（预防和处理）</p></li><li><p>分布式锁</p></li><li><p>队列</p></li><li><p>排行榜+点赞</p></li><li><p>……</p></li></ul><h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><ul><li>性能极高</li><li>数据类型丰富，key-value，list，set，zset，hash</li><li>支持数据的持久化</li><li>支持数据的备份，即master-slave模式的数据备份</li></ul><h3 id="Redis7新特性"><a href="#Redis7新特性" class="headerlink" title="Redis7新特性"></a>Redis7新特性</h3><ul><li><a class="link" target="_blank" rel="noopener" href="https://github.com/redis/redis/releases">https://github.com/redis/redis/releases <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>部分新特性总览<ul><li>Redis Functions：相当于Redis内部的lua脚本（不用了解）</li><li>Client-eviction：连续内存占用独立管理</li><li>Multi-part AOF：三个文件构成一个AOF文件（以前是一个文件）</li><li>ACL v2：精细化权限管理</li><li>新增命令<ul><li>新增ZMPOP，BZMPOP，LMPOP，BLMPOP等新命令</li><li>对于EXPIRE和SET命令，新增了更多的命令参数选项</li><li>需要用到再查文档即可</li></ul></li><li>listpack替代ziplist</li><li>底层性能提升</li></ul></li></ul><h3 id="Redis7安装相关"><a href="#Redis7安装相关" class="headerlink" title="Redis7安装相关"></a>Redis7安装相关</h3><ul><li>安装位置<code>/usr/bin</code><ul><li><code>redis-benchmark</code>：性能测试工具</li><li><code>redis-check-aof</code>：修复有问题的AOF文件</li><li><code>redis-check-rdb</code>：修复有问题的dump.rdb文件</li><li>==<code>redis-cli</code>==：客户端，操作入口</li><li><code>redis-sentinel</code>：Redis集群使用</li><li>==<code>redis-server</code>==：Redis服务器启动命令</li></ul></li><li>关闭<ul><li><code>redis</code>中：shutdown</li><li>单实例关闭：redis-cli -a 123456 shutdown</li><li>多实例，指定端口关闭：redis-cli -p 6379 shutdown</li></ul></li></ul><h2 id="Redis十大数据类型"><a href="#Redis十大数据类型" class="headerlink" title="Redis十大数据类型"></a>Redis十大数据类型</h2><p><a class="link" target="_blank" rel="noopener" href="https://redis.io/docs/data-types/">https://redis.io/docs/data-types/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h3 id="总体概括"><a href="#总体概括" class="headerlink" title="总体概括"></a>总体概括</h3><ul><li><code>String</code><ul><li>最基本的类型</li><li>是二进制安全的，意思是可以包含任何数据，比如图片或序列化的对象</li><li>最大512M</li></ul></li><li><code>List</code><ul><li><code>String</code>类型的列表</li><li>是一个双端链表</li><li>最多包含2^32-1个元素（约40亿）</li></ul></li><li><code>Hash</code><ul><li><code>String</code>类型的<code>field-value</code>映射表</li><li>特别适合存储对象</li><li>最多包含2^32-1个键值对（约40亿）</li></ul></li><li><code>Set</code><ul><li><code>String</code>类型的无序集合，成员是唯一的</li><li>集合对象的编码可以是<code>intset</code>或<code>hashtable</code>（后面会讲）</li><li>底层是通过<code>Hash</code>实现的</li><li>最多包含2^32-1个元素（约40亿）</li></ul></li><li><code>Sorted set</code>(<code>zset</code>)<ul><li>不同的是，每个元素都会关联一个<code>double</code>类型的分数，从小到大排序</li></ul></li><li><code>Geospatial</code><ul><li>存储地理位置</li><li>可以操作：添加地理位置的坐标，获取地理位置的坐标，计算位置间的距离，根据给定经纬度坐标获取指定范围内地理位置集合</li></ul></li><li><code>Hyperlog</code><ul><li>基数统计</li><li>输入元素非常大时，计算基数所需的空间总是固定且很小的</li><li>每个<code>HyperLogLog</code>键只需要12KB，就可以计算<code>2^64</code>个不同元素的基数</li><li>只会根据输入元素计算基数，不会存储元素本身</li></ul></li><li><code>Bitmap</code><ul><li>由0，1状态表现的二进制数组</li></ul></li><li><code>Bitfield</code><ul><li>可以一次性操作多个比特位域（连续多个比特位），会执行一系列操作并返回一个响应数组</li></ul></li><li><code>Stream</code><ul><li>主要用于消息队列</li><li>可实现<code>redis</code>版的消息中间件</li></ul></li></ul><h3 id="命令查询"><a href="#命令查询" class="headerlink" title="命令查询"></a>命令查询</h3><ul><li><p>官方英文：<a class="link" target="_blank" rel="noopener" href="https://redis.io/commands/">https://redis.io/commands/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></li><li><p>中文：<a class="link" target="_blank" rel="noopener" href="http://redis.cn/commands.html">http://redis.cn/commands.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></li></ul><h3 id="常用key操作命令"><a href="#常用key操作命令" class="headerlink" title="常用key操作命令"></a>常用key操作命令</h3><ul><li>查看当前库所有key</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keys *</span><br></pre></td></tr></table></figure></div><ul><li>判断某个key是否存在（返回存在个数）</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exists k1</span><br><span class="line">exists k1 k2 k3</span><br></pre></td></tr></table></figure></div><ul><li>返回值类型</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type k1</span><br></pre></td></tr></table></figure></div><ul><li>删除，成功返回1</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">del k1</span><br></pre></td></tr></table></figure></div><ul><li>非阻塞删除，仅将keys从keyspace元数据中删除，真正的删除将在后续异步中进行</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unlink key</span><br></pre></td></tr></table></figure></div><ul><li>查看还有多少秒过期，-1表示永不过期，-2表示已过期</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ttl key1</span><br></pre></td></tr></table></figure></div><ul><li>为key设置过期时间</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expire k1 100</span><br></pre></td></tr></table></figure></div><ul><li>切换数据库，index（0-15）</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 0</span><br></pre></td></tr></table></figure></div><ul><li>将当前数据库key移动到给定index（0-15）的数据库中</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">move key 2</span><br></pre></td></tr></table></figure></div><ul><li>查看当前数据库key的数量</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbsize</span><br></pre></td></tr></table></figure></div><ul><li>清空当前库</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flushdb</span><br></pre></td></tr></table></figure></div><ul><li>通杀全部库</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flushall</span><br></pre></td></tr></table></figure></div><h3 id="数据类型命令及落地应用"><a href="#数据类型命令及落地应用" class="headerlink" title="数据类型命令及落地应用"></a>数据类型命令及落地应用</h3><ul><li>命令不区分大小写，key区分</li><li>帮助命令</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">help @string</span><br></pre></td></tr></table></figure></div><h4 id="string字符串"><a href="#string字符串" class="headerlink" title="string字符串"></a>string字符串</h4><ul><li><p>最常用</p><ul><li><p><code>NX</code>：键不存在时才设置键值</p></li><li><p><code>XX</code>：键存在时才设置键值</p></li><li><p><code>GET</code>：返回键原本的值，原本无值返回<code>nil</code></p></li><li><p><code>EX seconds</code>：以秒为单位设置过期时间</p></li><li><p><code>PX milliseconds</code>：以毫秒为单位设置过期</p></li><li><p><code>EXAT unix-time-seconds</code>：以秒为单位的unix时间戳对应时间为过期时间</p></li><li><p><code>PXAT unix-time-milliseconds</code>：以毫秒为单位的unix时间戳对应时间为过期时间</p></li><li><p><code>KEEPTTL</code>：保留设置前指定键的生存时间</p></li></ul></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET key value [NX | XX] [GET] [EX seconds | PX milliseconds | EXAT unix-time-seconds | PXAT unix-time-milliseconds | KEEPTTL]</span><br></pre></td></tr></table></figure></div><ul><li>同时设置/获取多个值</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MSET k1 v1 k2 v2</span><br><span class="line">MGET k1 k2</span><br></pre></td></tr></table></figure></div><ul><li>不存在键时才设置为指定值</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SETNX key value</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MSETNX k1 v1 k2 v2 // 类似事务，都之前不存在才能被设置成功</span><br></pre></td></tr></table></figure></div><ul><li>设置/获取指定范围的值，左右都取</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set k1 abcdefg</span><br><span class="line">getrange k1 0 -1 // abcdefg</span><br><span class="line">getrange k1 0 4 // abcde</span><br></pre></td></tr></table></figure></div><ul><li>精准设置字符串值</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setrange k1 1 xxyy // 从1开始变为“xxyy”</span><br></pre></td></tr></table></figure></div><ul><li>数值递增/递减</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">incr k1</span><br><span class="line">incr k1 99</span><br><span class="line">decr k1</span><br><span class="line">decr k1 99</span><br></pre></td></tr></table></figure></div><ul><li>获取字符串长度和内容追加</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">strlen k1</span><br><span class="line">append k1 abcd</span><br></pre></td></tr></table></figure></div><ul><li>分布式锁</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setnx key value</span><br><span class="line">setex key value</span><br></pre></td></tr></table></figure></div><blockquote><p>setnx（set if not exist）</p><p>setex（set with expire）</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setex key seconds value // set的同时设置过期时间</span><br></pre></td></tr></table></figure></div><p>高阶篇再具体讲</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setnx lock uuid</span><br><span class="line">xxxx</span><br><span class="line">del lock</span><br></pre></td></tr></table></figure></div></blockquote><ul><li>getset，先get再set；最后返回oldValue</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getset k1 newValue</span><br></pre></td></tr></table></figure></div><h4 id="list列表"><a href="#list列表" class="headerlink" title="list列表"></a>list列表</h4><blockquote><p>底层是一个双端链表</p></blockquote><ul><li>入队以及遍历</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lpush list1 1 2 3 4 // 返回修改数</span><br><span class="line">rpush list2 1 2 3 4</span><br><span class="line">lrange list start end // 一定范围内遍历，没有rrange</span><br></pre></td></tr></table></figure></div><ul><li>出队</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lpop list1</span><br><span class="line">rpop list1</span><br></pre></td></tr></table></figure></div><ul><li>根据索引取值</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lindex list1 0 // 没有rindex</span><br></pre></td></tr></table></figure></div><ul><li>从左边开始，删除最多num个值为value的项</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lrem key num value</span><br></pre></td></tr></table></figure></div><ul><li>截取指定范围的值，代替原有值</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ltrim key start end</span><br></pre></td></tr></table></figure></div><ul><li>源列表右侧出队，目标列表左侧入队</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpoplpush source destination // 返回修改的那个值</span><br></pre></td></tr></table></figure></div><ul><li>设置对应索引的值</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lset key index value</span><br></pre></td></tr></table></figure></div><ul><li>在已有值（从左开始找到的第一个）前/后插入新值</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linsert key before/after 已有值 新值</span><br></pre></td></tr></table></figure></div><h4 id="hash哈希"><a href="#hash哈希" class="headerlink" title="hash哈希"></a>hash哈希</h4><blockquote><p>Map&lt;String, Map&lt;String, Object&gt;&gt;</p></blockquote><ul><li>基本操作</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hset key field1 value1 field2 value2 // 返回修改field的数量</span><br><span class="line">hget key field</span><br><span class="line">hmget key field1 field2</span><br><span class="line">hgetall key</span><br><span class="line">hdel key field1 field2</span><br></pre></td></tr></table></figure></div><blockquote><p>hmset已被弃用，使用hset代替</p></blockquote><ul><li>获取某个key，field的数量</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hlen key</span><br></pre></td></tr></table></figure></div><ul><li>某个key是否存在某个field，返回0或1</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexists key field</span><br></pre></td></tr></table></figure></div><ul><li>获取某个key中所有field/value</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hkeys k1</span><br><span class="line">hvals k1</span><br></pre></td></tr></table></figure></div><ul><li>值增加</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hincrby key field value // 整数，返回修改后的值</span><br><span class="line">hincrbyfloat key field value // 小数，返回修改后的值</span><br></pre></td></tr></table></figure></div><ul><li>不存在才赋值</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hsetnx key field value // 返回0或1</span><br></pre></td></tr></table></figure></div><blockquote><p>应用场景：购物车（现在不这样做了，中小厂可以这样做）</p><ul><li>新增商品</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hset shopcar:uid1024 334488 1</span><br><span class="line">hset shopcar:uid1024 334477 1</span><br></pre></td></tr></table></figure></div><ul><li>增加商品数量</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hincrby shopcar:uid1024 334488 1</span><br></pre></td></tr></table></figure></div><ul><li>商品总数</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hlen shopcar:uuid1024</span><br></pre></td></tr></table></figure></div><ul><li>全选</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgetall shopcar:uuid1024</span><br></pre></td></tr></table></figure></div></blockquote><h4 id="set集合"><a href="#set集合" class="headerlink" title="set集合"></a>set集合</h4><ul><li>添加元素</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sadd key member1 member2</span><br></pre></td></tr></table></figure></div><ul><li>删除元素</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">srem key member1 member2</span><br></pre></td></tr></table></figure></div><ul><li>遍历所有元素</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smenbers key</span><br></pre></td></tr></table></figure></div><ul><li>判断元素是否在集合中</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sismember key member</span><br></pre></td></tr></table></figure></div><ul><li>统计元素数量</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scard key</span><br></pre></td></tr></table></figure></div><ul><li>从集合中随机展现指定个数个元素</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">srandmember key 5</span><br></pre></td></tr></table></figure></div><ul><li>从集合中随机弹出指定个数个元素，元素会被删除</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spop key 5</span><br></pre></td></tr></table></figure></div><ul><li>将一个元素从一个set移动到另外一个set，返回0或1</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smove source destination member</span><br></pre></td></tr></table></figure></div><ul><li>集合运算</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 差集运算：A - B - C</span><br><span class="line">sdiff key1 key2 key3</span><br><span class="line"></span><br><span class="line">// 并集运算：A ∪ B ∪ C</span><br><span class="line">sunion key1 key2 key3</span><br><span class="line"></span><br><span class="line">// 交集运算：A ∩ B ∩ C</span><br><span class="line">sinter key1 key2 key3</span><br><span class="line">sintercard numkeys key [key ...] // redis7.0新出的，返回交集运算结果的基数</span><br><span class="line">sintercard 2 set1 set2</span><br><span class="line">sintercard 2 set1 set2 limit 4 // 可以设置上限</span><br></pre></td></tr></table></figure></div><blockquote><p>应用场景：</p><p>微信抽奖小程序：</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sadd key userId		// 立即参与</span><br><span class="line">scard key			// 统计参与人次</span><br><span class="line">srandmember key 2	// 随机抽奖2个人，元素不删除（中奖可重复）</span><br><span class="line">spop key 2			// 随机抽奖2个人，元素删除（中奖不可重复）</span><br></pre></td></tr></table></figure></div><p>朋友圈点赞</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sadd pub:msgId userId1 userId2	// 新增点赞</span><br><span class="line">srem pub:msgId userId1			// 取消点赞</span><br><span class="line">smembers pub:msgId				// 展现所有点赞用户</span><br><span class="line">scard pub:msgId					// 点赞数</span><br><span class="line">sismember pub:msgId userId1		// 判断是否点赞过</span><br></pre></td></tr></table></figure></div><p>qq可能认识的人</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sadd s1 1 2 3 4 5</span><br><span class="line">sadd s2 3 4 5 6 7</span><br><span class="line">sinter s1 s2	// 共同认识</span><br><span class="line">sdiff s1 s2		// s2可能认识</span><br><span class="line">sdiff s2 s1		// s1可能认识</span><br></pre></td></tr></table></figure></div></blockquote><h4 id="zset有序集合"><a href="#zset有序集合" class="headerlink" title="zset有序集合"></a>zset有序集合</h4><blockquote><p>在set基础上，每个val值前加上一个score分数</p></blockquote><ul><li>基础</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set v1 v2 </span><br><span class="line">zset score1 v1 score2 v2 </span><br></pre></td></tr></table></figure></div><ul><li>添加元素</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zadd zset1 60 v1 70 v2 30 v3</span><br></pre></td></tr></table></figure></div><ul><li>遍历元素</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 元素排序从小到大</span><br><span class="line">zrange zset1 0 -1</span><br><span class="line">zrange zset1 0 -1 withscores // 带分数的遍历</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 元素排序从大到小</span><br><span class="line">zrevrange zset1 0 -1</span><br><span class="line">zrevrange zset1 0 -1 withscores // 带分数的遍历</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zrangebyscore key 60 90		// 指定分数范围内</span><br><span class="line">zrangebyscore key ( 60 90	// 不包含60 </span><br><span class="line">zrangebyscore key 60 ( 90	// 不包含90 </span><br><span class="line">zrangebyscore key 60 90 limit 0 6	// 类似分页，从0开始6个</span><br></pre></td></tr></table></figure></div><ul><li>查询score</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zscore key member	// 返回分值</span><br></pre></td></tr></table></figure></div><ul><li>获取元素个数</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zcard key</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zcount key min max // 指定分数范围元素个数</span><br></pre></td></tr></table></figure></div><ul><li>删除元素</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zrem key member1 member2 // 返回删除个数</span><br></pre></td></tr></table></figure></div><ul><li>增加分数</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zincrby key 3 member // 增加某个元素的分数</span><br></pre></td></tr></table></figure></div><ul><li>弹出元素</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ZMPOP numkeys key [key ...] &lt;MIN | MAX&gt; [COUNT count]</span><br><span class="line">// 从小到大or从大到小，弹出指定数量的元素</span><br><span class="line">// count负责控制弹出多少，不写默认为1</span><br></pre></td></tr></table></figure></div><ul><li>获取下标值</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zrank key value		// 从小到大</span><br><span class="line">zrevrank key value	// 从大到小</span><br></pre></td></tr></table></figure></div><blockquote><p>应用场景：</p><p>根据商品销量进行排序</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zadd goods:sellsort 9 1001 15 1002</span><br><span class="line">zrange goods:sellsort 0 10 with scores	// 销量前十</span><br><span class="line">zincrby goods:sellsort 2 1001			// 1001商品销量加2</span><br><span class="line">zrange goods:sellsort 0 10 with scores	// 销量前十</span><br></pre></td></tr></table></figure></div></blockquote><h4 id="bitmap位图"><a href="#bitmap位图" class="headerlink" title="bitmap位图"></a>bitmap位图</h4><blockquote><p>由0和1状态表现的二进制数组</p><p>底层基于string类型，按位操作</p></blockquote><ul><li>设置</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">setbit key offset value // value只能是0或1</span><br><span class="line"></span><br><span class="line">setbit k1 0 1</span><br><span class="line">setbit k1 1 1</span><br><span class="line">setbit k1 2 1</span><br><span class="line">setbit k1 3 0</span><br><span class="line">type k1 // string</span><br></pre></td></tr></table></figure></div><ul><li>获取值</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getbit k1 0</span><br><span class="line">getbit k1 1</span><br><span class="line">getbit k1 2</span><br></pre></td></tr></table></figure></div><ul><li>strlen</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 底层是string，超过8位后，按照8位一组（1 byte）扩容</span><br><span class="line">setbit k2 0 1</span><br><span class="line">setbit k2 7 1</span><br><span class="line">strlen k2		// 1</span><br><span class="line">setbit k2 8 1</span><br><span class="line">strlen k2		// 2</span><br></pre></td></tr></table></figure></div><ul><li>bitcount</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bitcount key	// 全部1的个数</span><br></pre></td></tr></table></figure></div><ul><li>进行位操作（and or xor not）</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 最终结果将放到destkey中</span><br><span class="line">BITOP &lt;AND | OR | XOR | NOT&gt; destkey key [key ...] // 返回0或1指示是否成功</span><br></pre></td></tr></table></figure></div><blockquote><p>应用场景：签到</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">setbit sign:u1:202106 0 1	// 某用户21年6月，第一天签到了</span><br><span class="line">setbit sign:u1:202106 1 1</span><br><span class="line">setbit sign:u1:202106 2 1</span><br><span class="line">setbit sign:u1:202106 29 1</span><br><span class="line"></span><br><span class="line">getbit sign:u1:202106 2		// 第二天来没来</span><br><span class="line">bitcount sign:u1:202106		// 21年6月来了多少天</span><br></pre></td></tr></table></figure></div></blockquote><h4 id="hyperloglog基数统计"><a href="#hyperloglog基数统计" class="headerlink" title="hyperloglog基数统计"></a>hyperloglog基数统计</h4><blockquote><p>用来做基数统计的，在输入元素的数量或体积特别大时，计算基数所需的空间总是固定且很小的</p><p>每个<code>HyperLogLog</code>键只需要花费<code>12KB</code>，就可以计算<code>2^64</code>个不同元素的基数（标准误差0.81%）</p><p>底层类型<code>string</code></p><ul><li>基数：一种数据集，去重后的真实个数</li></ul></blockquote><ul><li>添加指定元素到HyperLogLog</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pfadd key element1 element2</span><br></pre></td></tr></table></figure></div><ul><li>返回给定HyperLogLog的基数估算值</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pfcount key</span><br></pre></td></tr></table></figure></div><ul><li>将多个HyperLogLog合并为同一个</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pfmerge destkey sourcekey1 sourcekey2 sourcekey3</span><br></pre></td></tr></table></figure></div><h4 id="geo地理空间"><a href="#geo地理空间" class="headerlink" title="geo地理空间"></a>geo地理空间</h4><blockquote><p>底层zset类型</p></blockquote><ul><li>添加经纬度坐标<ul><li>解决中文乱码问题：redis-cli -a 111111 –raw</li></ul></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geoadd city 116.403963 39.915119 天安门 116.403414 39.924091 故宫 116.024067 40.362639 长城 // 返回添加的个数</span><br></pre></td></tr></table></figure></div><ul><li>返回经纬度</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geopos key member1 member2 member3</span><br></pre></td></tr></table></figure></div><ul><li>返回坐标的geohash表示<ul><li>geohash算法生成的base32编码值</li></ul></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geohash key member1 member2 member3</span><br></pre></td></tr></table></figure></div><ul><li>返回距离</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geodist key member1 member2 [m|km|ft|mi]</span><br></pre></td></tr></table></figure></div><ul><li>查找指定半径中的位置<ul><li>withdist：返回距离</li><li>withcoord：返回坐标</li><li>withhash：返回位置经过geohash编码后的值</li><li>count：限定返回记录数</li><li>asc/desc：由近到远/由远到近</li><li>store/storedist：将结果保存到zset，前者score是geohash值，后者是距离</li></ul></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GEORADIUS key longitude latitude radius &lt;M | KM | FT | MI&gt;</span><br><span class="line">  [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count [ANY]] [ASC | DESC]</span><br><span class="line">  [STORE key] [STOREDIST key]</span><br></pre></td></tr></table></figure></div><h4 id="stream流"><a href="#stream流" class="headerlink" title="stream流"></a>stream流</h4><blockquote><p>就是redis版本的消息中间件（MQ）+阻塞队列</p><ul><li>list实现消息队列：<ul><li>用来做异步队列</li><li>点对点模式</li></ul></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lpush mylist a b c d e</span><br><span class="line">rpop mylist</span><br><span class="line">rpop mylist</span><br></pre></td></tr></table></figure></div><ul><li>pub/sub发布和订阅机制实现消息队列：<ul><li>一对多模式</li><li>缺点：消息无法持久化，如果网络断开，宕机等，消息就会丢失；而且也没有ACK机制保证数据可靠性</li></ul></li></ul></blockquote><ul><li><p>能干什么</p><ul><li>实现消息队列</li><li>支持消息持久化</li><li>支持自动生成全局唯一id</li><li>支持ack确定消息的模式</li><li>支持消费组模式</li><li>…让消息队列更加稳定可靠</li></ul></li><li><p>底层结构</p><ul><li>一个消息链表，每个消息都有唯一id和相应内容</li></ul></li></ul><table><thead><tr><th>名称</th><th>内涵</th></tr></thead><tbody><tr><td>Message Content</td><td>消息内容</td></tr><tr><td>Consumer group</td><td>消费组，通过xgroup create命令创建，同一个消费组可以有多个消费者</td></tr><tr><td>Last_delivered_id</td><td>游标，每个消费组都有一个，任意消费者读取了消息都会使游标往前移</td></tr><tr><td>Consumer</td><td>消费者，消费组中的消费者</td></tr><tr><td>Pending_ids</td><td>消费者会有一个状态变量，用于记录已读取未ack的消息id。<br>如果客户端没有ack，这个变量中的id会越来越多；一旦某个消息被ack，它就开始减少。<br>这个变量Redis官方称之为PEL（Pending），记录当前已被客户端读取，但还没有ack的消息。<br>它用来确保客户端至少消费了消息一次，而不会在网络传输的过程中丢失了没处理</td></tr></tbody></table><h5 id="队列相关指令"><a href="#队列相关指令" class="headerlink" title="队列相关指令"></a>队列相关指令</h5><ul><li>添加消息到队列末尾<ul><li>消息id必须比上一个大</li><li>*表示自动生成规矩（让系统自动生成id）</li></ul></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xadd mystream * k1 v1 k2 v2 // 返回消息id："1678332037505-0"，该毫秒下第0条消息</span><br></pre></td></tr></table></figure></div><blockquote><p>如果当前毫秒时间戳比以前已存在的小，系统会采用以前相同的毫秒创建新的id（自动纠错）</p><p>redis对id有强制要求，格式必须是==时间戳-自增id==，且后续id不能小于前一个</p></blockquote><ul><li>遍历所有消息</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xrange key start end [count num] // -表示开始值，+表示结束值</span><br><span class="line">xrange key - + count 2</span><br><span class="line">xrevrange key + - count 2</span><br></pre></td></tr></table></figure></div><ul><li>删除消息</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xdel key id</span><br></pre></td></tr></table></figure></div><ul><li>获取消息队列长度</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xlen key</span><br></pre></td></tr></table></figure></div><ul><li>对stream长度进行截取，如超长会截取</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// maxlen: 允许的最大长度</span><br><span class="line">// minid：允许的最小id</span><br><span class="line">xtrim key maxlen 2 minid 1678332037505-0</span><br></pre></td></tr></table></figure></div><ul><li>读取消息</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// COUNT: 最多读取多少条信息</span><br><span class="line">// BLOCK: 是否堵塞的方式读取消息，默认不阻塞；如果miliseconds设为0，表示永远堵塞</span><br><span class="line">xread [COUNT count] [BLOCK miliseconds] streams key1 key2 key3</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xread count 2 streams mystream $	// $是特殊id，表示stream已经存储的最大id的后一个id。此处返回nil</span><br><span class="line">xread count 2 streams mystream 0-0	// 0-0代表从最小id开始获取stream中的消息，也可使用0;00;000</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xread count 1 block 0 streams mystream $	// 阻塞等待，一直等到出现新的id。还会返回等待时间</span><br></pre></td></tr></table></figure></div><h5 id="消费组相关指令"><a href="#消费组相关指令" class="headerlink" title="消费组相关指令"></a>消费组相关指令</h5><ul><li>创建消费组</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xgroup create key groupA $	// $表示从尾开始消费（只消费新的）</span><br><span class="line">xgroup create key groupB 0	// 0表示从头开始消费</span><br></pre></td></tr></table></figure></div><ul><li>消费组读取信息</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xreadgroup group groupB consumer1 streams mystream &gt;	// 能读到消息</span><br><span class="line">xreadgroup group groupB consumer2 streams mystream &gt;	// nil，消息一旦被消费组中一个消费者读取了，就不能再次被组内其他消费者读取了</span><br><span class="line"></span><br><span class="line">// 组内多个消费者分担读取，实现读取的负载均衡</span><br><span class="line">xreadgroup group groupC consumer1 count 1 streams mystream &gt;</span><br><span class="line">xreadgroup group groupC consumer2 count 1 streams mystream &gt;</span><br><span class="line">xreadgroup group groupC consumer3 count 1 streams mystream &gt;</span><br></pre></td></tr></table></figure></div><blockquote><p>消息一旦被消费组中一个消费者读取了，就不能再次被组内其他消费者读取了</p><p>不同消费组之间不受影响</p></blockquote><ul><li>查询消费组内，所有消费者“已读取，但尚未确认”的消息</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xpending mystream groupA</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 返回值：总条数；起始时间戳；消费者极其消费的条数</span><br><span class="line">1) (integer) 4</span><br><span class="line">2) "1678332037505-0"</span><br><span class="line">3) "1678347842560-0"</span><br><span class="line">4) 1) 1) "constomer1"</span><br><span class="line">      2) "4"</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xpending mystream groupB - + 10 consumer2</span><br></pre></td></tr></table></figure></div><ul><li>签收消息</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xack mystream groupB 1678332037505-0</span><br></pre></td></tr></table></figure></div><ul><li>打印Stream/Consumer/Group的详细信息</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xinfo stream mystream</span><br></pre></td></tr></table></figure></div><pre class="mermaid">graph LR;
    Publisher--"xadd"--&gt;Stream
    Stream--&gt;Consumer1
    Stream--"xgroupcreate"--&gt;Consumer2
    Stream--&gt;Consumer3
    Consumer2--"xreadgroup"--&gt;Client
    Client--"xack"--&gt;Consumer2</pre><h4 id="bitfield位域"><a href="#bitfield位域" class="headerlink" title="bitfield位域"></a>bitfield位域</h4><ul><li>了解即可</li></ul><h2 id="Redis持久化"><a href="#Redis持久化" class="headerlink" title="Redis持久化"></a>Redis持久化</h2><ul><li><p>redis持久化方式</p><ul><li><p>RDB (Redis Database)</p></li><li><p>AOF (Append Only File)</p></li><li><p>RDB + AOF</p></li></ul></li></ul><h3 id="RDB方式"><a href="#RDB方式" class="headerlink" title="RDB方式"></a>RDB方式</h3><ul><li><p>以指定的时间间隔，执行数据集的时间点快照</p><ul><li>保存备份时是全量快照</li><li>dump.rdb</li></ul></li><li><p>保存时间间隔，配置文件（6 vs 7）</p><ul><li>以前</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">save 900 1 # 900s,1次修改</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure></div><ul><li>现在</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">save 3600 1 300 100 60 10000</span><br></pre></td></tr></table></figure></div></li></ul><h4 id="配置说明"><a href="#配置说明" class="headerlink" title="配置说明"></a>配置说明</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/redis/redis.conf</span><br></pre></td></tr></table></figure></div><ul><li>本次案例5秒2次修改</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Unless specified otherwise, by default Redis will save the DB:</span><br><span class="line">#   * After 3600 seconds (an hour) if at least 1 change was performed</span><br><span class="line">#   * After 300 seconds (5 minutes) if at least 100 changes were performed</span><br><span class="line">#   * After 60 seconds if at least 10000 changes were performed</span><br><span class="line">#</span><br><span class="line"># You can set these explicitly by uncommenting the following line.</span><br><span class="line">#</span><br><span class="line"># save 3600 1 300 100 60 10000</span><br><span class="line">save 5 2</span><br></pre></td></tr></table></figure></div><ul><li>修改dump文件保存位置</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># The working directory.</span><br><span class="line">#</span><br><span class="line"># The DB will be written inside this directory, with the filename specified</span><br><span class="line"># above using the 'dbfilename' configuration directive.</span><br><span class="line">#</span><br><span class="line"># The Append Only File will also be created inside this directory.</span><br><span class="line">#</span><br><span class="line"># Note that you must specify a directory here, not a file name.</span><br><span class="line"># dir /var/lib/redis</span><br><span class="line">dir /home/xdy/myredis/dumpfiles</span><br></pre></td></tr></table></figure></div><ul><li>修改默认文件名</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># The filename where to dump the DB</span><br><span class="line"># dbfilename dump.rdb</span><br><span class="line">dbfilename dump6379.rdb</span><br></pre></td></tr></table></figure></div><ul><li>开启redis</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redis-server ./redis-my.config</span><br><span class="line">redis-cli</span><br><span class="line"></span><br><span class="line">// 获取配置，查看修改成功与否</span><br><span class="line">config get save</span><br><span class="line">config get dir</span><br><span class="line">config get dbfilename</span><br></pre></td></tr></table></figure></div><h4 id="自动触发"><a href="#自动触发" class="headerlink" title="自动触发"></a>自动触发</h4><ul><li>依照save所设置的那样</li><li>恢复方式<ul><li>将备份的dump.rdb移动到设置的目录中即可</li></ul></li></ul><h4 id="手动触发"><a href="#手动触发" class="headerlink" title="手动触发"></a>手动触发</h4><ul><li><p>save</p><ul><li>会阻塞当前redis服务器，期间redis不能处理其他命令</li><li>线上禁止使用！</li></ul></li><li><p>bgsave</p><ul><li>后台异步进行快照操作</li><li>如何工作的<ul><li>redis forks，此时我们有一个子进程一个父进程</li><li>子进程开始将数组从内存写到硬盘</li><li>子进程完成后，会替换旧的进程</li></ul></li></ul></li><li><p>lastsave</p><ul><li>获取最后一次成功执行快照的时间</li></ul></li></ul><h4 id="RDB优缺点"><a href="#RDB优缺点" class="headerlink" title="RDB优缺点"></a>RDB优缺点</h4><ul><li>优势<ul><li>适合大规模数据恢复</li><li>按照业务定时备份</li><li>对数据完整性和一致性要求不高</li><li>RDB文件在内存中加载速度比AOF快得多</li></ul></li><li>劣势<ul><li>如果redis意外宕掉，快照之后的数据会丢失</li><li>数据量太大会导致I/O，严重影响性能</li><li>RDB依赖于主进程的fork，可能导致请求的瞬间延迟。fork时内存数据被克隆，有2倍的膨胀</li></ul></li></ul><h4 id="RDB修复命令简介"><a href="#RDB修复命令简介" class="headerlink" title="RDB修复命令简介"></a>RDB修复命令简介</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-check-rdb dump6379.rdb</span><br></pre></td></tr></table></figure></div><h4 id="RDB触发小结和快照禁用"><a href="#RDB触发小结和快照禁用" class="headerlink" title="RDB触发小结和快照禁用"></a>RDB触发小结和快照禁用</h4><ul><li><p>触发</p><ul><li>配置文件中默认的配置</li><li>手动save/bgsave</li><li>执行flushall/flushdb，但里面是空的意义不大</li><li>执行shutdown，且没有开启AOF持久化</li><li>主从复制时，主节点主动触发</li></ul></li><li><p>如何禁用快照</p><ul><li>动态停止保存规则</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli config set save ""</span><br></pre></td></tr></table></figure></div><ul><li>快照禁用</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Snapshotting can be completely disabled with a single empty string argument</span><br><span class="line"># as in following example:</span><br><span class="line">#</span><br><span class="line">save ""</span><br></pre></td></tr></table></figure></div></li></ul><h4 id="RDB优化配置项"><a href="#RDB优化配置项" class="headerlink" title="RDB优化配置项"></a>RDB优化配置项</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">save &lt;seconds&gt; &lt;change&gt;</span><br><span class="line">dbfilename</span><br><span class="line">dir</span><br><span class="line"></span><br><span class="line"># 快照写入失败时，redis是否继续接收新的写请求</span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line"></span><br><span class="line"># 存储到磁盘的快照是否压缩</span><br><span class="line">rdbcompression yes</span><br><span class="line"></span><br><span class="line"># 存储快照后，是否进行数据校验</span><br><span class="line">rdbchecksum yes</span><br><span class="line"></span><br><span class="line"># Redis主从全量同步时，通过RDB文件传输实现。</span><br><span class="line"># 如果没有开启持久化，同步完成后，是否要移除主从同步的RDB文件，默认为no。</span><br><span class="line">rdb-del-sync-files no</span><br></pre></td></tr></table></figure></div><h3 id="AOF方式"><a href="#AOF方式" class="headerlink" title="AOF方式"></a>AOF方式</h3><ul><li><p>是什么</p><ul><li>以日志的形式来记录每个写操作</li><li>redis启动之初，会读取该文件重新构建数据</li></ul></li><li><p>开启方式</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 配置文件中默认未开启</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure></div></li></ul><h4 id="AOF工作流程和写回操作"><a href="#AOF工作流程和写回操作" class="headerlink" title="AOF工作流程和写回操作"></a>AOF工作流程和写回操作</h4><ul><li><p>工作流程</p><ul><li><p>Client作为命令来源，会有多个源头，请求命令源源不断</p></li><li><p>这些命令先放入AOF缓存中进行保存</p></li><li><p>AOF缓存会根据AOF缓冲区，==同步文件的三种写回策略==，将命令写入磁盘上的AOF文件</p></li><li><p>随着写入AOF内容的增加，会==根据规则进行命令的合并==（又称AOF重写）</p></li></ul></li><li><p>三种写回策略</p><ul><li>always：每个命令执行完，立刻同步将日志写回磁盘</li><li>everysec：先把日志写到AOF文件的内存缓冲区，每隔一秒将缓冲区内容写回磁盘</li><li>no：先把日志写到AOF文件的内存缓冲区，由操作系统决定何时将缓冲区内容写回磁盘</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 配置文件，默认everysec</span><br><span class="line">appendfsync everysec</span><br></pre></td></tr></table></figure></div><blockquote><p>总结：</p><table><thead><tr><th>配置项</th><th>写回时机</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>always</td><td>同步写回</td><td>可靠性高，数据基本不丢失</td><td>每个命令都要落盘，性能影响大</td></tr><tr><td>everysec</td><td>每秒写回</td><td>性能适中</td><td>宕机时丢失1秒内数据</td></tr><tr><td>no</td><td>操作系统控制的写回</td><td>性能好</td><td>宕机时丢失数据较多</td></tr></tbody></table></blockquote></li></ul><h4 id="AOF功能配置开启"><a href="#AOF功能配置开启" class="headerlink" title="AOF功能配置开启"></a>AOF功能配置开启</h4><ul><li>配置开启</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 配置文件中默认未开启</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line"># 使用默认写回策略</span><br><span class="line">appendfsync everysec</span><br></pre></td></tr></table></figure></div><ul><li>AOF文件保存路径，AOF文件保存名称</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># redis6之前</span><br><span class="line"></span><br><span class="line">dir /myredis</span><br><span class="line">appendfilename "appendonly.aof"</span><br><span class="line"></span><br><span class="line"># RDB: /myredis/dump.rdb</span><br><span class="line"># AOF: /myredis/appendonly.aof</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># redis7</span><br><span class="line"></span><br><span class="line">dir /myredis</span><br><span class="line">appendfilename "appendonly.aof"</span><br><span class="line">appenddirname "appendonlydir"</span><br><span class="line"></span><br><span class="line"># RDB:	/myredis/dump.rdb</span><br><span class="line"># AOF:	/myredis/appendonlydir/appendonly.aof.1.base.rdb</span><br><span class="line">#		/myredis/appendonlydir/appendonly.aof.1.incr.aof, appendonly.aof.2.incr.aof, ...</span><br><span class="line">#		/myredis/appendonlydir/appendonly.aof.manifest</span><br></pre></td></tr></table></figure></div><blockquote><p>base: 基础AOF，由子进程通过重写产生，该文件最多一个</p><p>incr: 增量AOF，后续写操作记录其中，该文件可能存在多个</p><p>history: 历史AOF，由base和incr变化而来，每次AOFRW成功完成，本次之前对应的base和incr都将变为history。==history类型的aof会被redis自动删除==</p><p>manifest: 清单文件，来跟踪管理这些AOF文件</p></blockquote><h4 id="AOF正常恢复"><a href="#AOF正常恢复" class="headerlink" title="AOF正常恢复"></a>AOF正常恢复</h4><ul><li>写操作，自动生成AOF文件到指定目录</li><li>恢复，重启redis时自动加载</li></ul><h4 id="AOF异常恢复"><a href="#AOF异常恢复" class="headerlink" title="AOF异常恢复"></a>AOF异常恢复</h4><ul><li>可能：内容写了一小半，没有写完整，突然redis挂了，导致AOF文件错误</li><li>往appendonly.aof.1.incr.aof最后一行胡乱插入一行，模拟文件损坏的情况</li><li>AOF文件有误，发现无法启动redis，连接直接报错</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 异常修复指令</span><br><span class="line"># redis-check-aof --fix &lt;file.manifest|file.aof&gt;</span><br><span class="line"></span><br><span class="line">redis-check-aof --fix ./appendonly.aof.1.incr.aof</span><br></pre></td></tr></table></figure></div><h4 id="AOF优缺点"><a href="#AOF优缺点" class="headerlink" title="AOF优缺点"></a>AOF优缺点</h4><ul><li>优点：<ul><li>更好保护数据不丢失，性能高，可做紧急恢复</li></ul></li><li>缺点<ul><li>AOF文件远大于RDB文件，恢复速度慢于RDB</li><li>根据不同的同步策略，AOF一般都比RDB慢。everysec的情况下，性能消耗任然很高。即使no的情况下，也和RDB差不多快。</li></ul></li></ul><h4 id="AOF重写机制"><a href="#AOF重写机制" class="headerlink" title="AOF重写机制"></a>AOF重写机制</h4><ul><li><p>自动触发</p><ul><li>是上次rewrite后大小的一倍，且文件大于64M</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 官方默认配置</span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line"></span><br><span class="line"># 是否同时开启rdb和aof。默认是yes，这里为了实验方便，设为no</span><br><span class="line">aof-use-rdb-preamble no</span><br></pre></td></tr></table></figure></div></li><li><p>手动触发</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bgrewriteaof</span><br></pre></td></tr></table></figure></div></li></ul><blockquote><p>AOF文件重写并不是对原文件重新整理，而是直接读取服务器现有键值对，生成新的AOF文件代替原来AOF文件</p></blockquote><h4 id="AOF重写原理"><a href="#AOF重写原理" class="headerlink" title="AOF重写原理"></a>AOF重写原理</h4><ol><li>redis fork一个子进程。子进程基于当前内存中的数据，构建日志，往新的临时AOF文件中写入日志</li><li>开启AOF重写缓冲区。保存这段时间内新增的写指令</li><li>主进程继续写旧文件。写入AOF重写缓冲区，进而继续写入旧AOF文件</li><li>AOF重写缓冲区的指令追加到新文件</li><li>新AOF文件替代旧AOF文件</li></ol><h3 id="RDB-AOF混合持久化"><a href="#RDB-AOF混合持久化" class="headerlink" title="RDB-AOF混合持久化"></a>RDB-AOF混合持久化</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 混合模式默认开启</span><br><span class="line">aof-use-rdb-preamble yes</span><br></pre></td></tr></table></figure></div><h4 id="数据恢复流程和加载顺序"><a href="#数据恢复流程和加载顺序" class="headerlink" title="数据恢复流程和加载顺序"></a>数据恢复流程和加载顺序</h4><ul><li>默认开启RDB</li><li>如果开启AOF，优先加载AOF</li></ul><pre class="mermaid">graph TB;
    A[加载]--&gt;B{存在AOF?}
    B--&gt;|yes|C[加载AOF文件]
    B--&gt;|no|D{存在RDB}
    D--&gt;|yes|E[加载RDB文件]
    C--&gt;F[启动成功or失败]
    E--&gt;F
    D--&gt;|no|F</pre><h4 id="使用选择"><a href="#使用选择" class="headerlink" title="使用选择"></a>使用选择</h4><ul><li>AOF保存更完整，因此优先使用AOF恢复</li><li>RDB适合用于备份数据库（AOF不断变化不好备份）</li><li>推荐：RDB+AOF混合使用</li></ul><h4 id="纯缓存模式"><a href="#纯缓存模式" class="headerlink" title="纯缓存模式"></a>纯缓存模式</h4><ul><li>同时关闭RDB+AOF</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 禁用rdb持久化模式下，仍可以使用save，bgsave命令生成rdb文件</span><br><span class="line">save ""</span><br><span class="line"></span><br><span class="line"># 禁用AOF功能，仍可以使用bgrewriteaof生成aof文件</span><br><span class="line">appendonly no</span><br></pre></td></tr></table></figure></div><h2 id="Redis事务"><a href="#Redis事务" class="headerlink" title="Redis事务"></a>Redis事务</h2><ul><li>依次执行多个命令，本质就是一组命令的集合</li><li>一个事务中所有命令都会序列化，按顺序串行执行，不会被其他命令加塞</li></ul><h3 id="Redis事务vs数据库事务"><a href="#Redis事务vs数据库事务" class="headerlink" title="Redis事务vs数据库事务"></a>Redis事务vs数据库事务</h3><ol><li>单独的隔离操作<ul><li>redis事务仅仅保证事务中操作会被连续独占的执行。（redis命令执行是单线程架构）</li></ul></li><li>没有隔离级别的概念<ul><li>事务提交前任何指令都不会被实际执行</li></ul></li><li>不保证原子性<ul><li>redis不保证所有指令同时成功或失败，只有决定是否开始执行全部指令的能力，没有回滚的能力</li></ul></li><li>排他性<ul><li>redis会保证一个事务内的命令依次执行，不被其他命令插入</li></ul></li></ol><h3 id="使用案例"><a href="#使用案例" class="headerlink" title="使用案例"></a>使用案例</h3><ul><li>正常执行</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">multi</span><br><span class="line">set k1 v1</span><br><span class="line">expire k1 30</span><br><span class="line">exec</span><br></pre></td></tr></table></figure></div><ul><li>放弃执行</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">multi</span><br><span class="line">set k1 v1</span><br><span class="line">discard</span><br></pre></td></tr></table></figure></div><ul><li>全体连坐<ul><li>在exec执行之前，有命令出错，全体无法执行</li></ul></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">multi</span><br><span class="line">set k1	# 发生错误</span><br><span class="line">exec	# Redis直接返回错误，所有命令都不会执行</span><br></pre></td></tr></table></figure></div><ul><li>冤有头债有主<ul><li>在exec执行之后出错，其他命令不受影响（redis没有rollbask功能）</li></ul></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">multi</span><br><span class="line">set email 1234@qq.com</span><br><span class="line">incr email	# 运行时错误</span><br><span class="line">exec		# 其他命令不受影响</span><br></pre></td></tr></table></figure></div><ul><li>watch监控<ul><li>Redis使用watch来提供乐观锁，类似于CAS（Check-and-Set）</li></ul></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">set balance 100</span><br><span class="line">watch balance # 一种乐观锁的实现，监控key，如果key被修改了，后面的事务执行失败</span><br><span class="line"></span><br><span class="line">multi</span><br><span class="line">set k1 v1</span><br><span class="line">set balance 110</span><br><span class="line">exec # 有人加塞，修改了balance，事务不会执行</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 上面 watch 和 exec之间，有人加塞</span><br><span class="line">set balance 300</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 放弃监控</span><br><span class="line">unwatch</span><br></pre></td></tr></table></figure></div><h2 id="Redis管道"><a href="#Redis管道" class="headerlink" title="Redis管道"></a>Redis管道</h2><ul><li><p>Redis是一种基于==客户端-服务器模型==的<code>TCP</code>服务</p><ul><li>客户端向服务器发送命令（发送命令，命令排队，命令执行，返回结果），并监听Socket返回，通常阻塞模式等待服务器响应</li><li>服务器处理命令，并将结果返回客户端</li><li>如果执行大量命令，就有大量RTT，性能不太好</li></ul></li><li><p><code>pipeline</code>可以一次发送多条命令给服务器，服务器依次处理完，一次性响应，减少了通信次数</p><ul><li>批处理命令变种优化措施，类似Redis的原生批命令（mget，mset）</li></ul></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat cmd.txt</span><br><span class="line">set k1 v1</span><br><span class="line">set k2 v2</span><br><span class="line">hset k3 name xdy</span><br><span class="line">hset k3 age 12</span><br><span class="line">hset k3 gender male</span><br><span class="line">lpush list 1 2 3 4 5</span><br><span class="line"></span><br><span class="line">cat cmd.txt | redis-cli -a 111111 --pipe</span><br></pre></td></tr></table></figure></div><h3 id="管道与原生批量命令对比"><a href="#管道与原生批量命令对比" class="headerlink" title="管道与原生批量命令对比"></a>管道与原生批量命令对比</h3><ul><li>原生批量命令有原子性，管道是非原子性</li><li>原生批量命令一次只能执行一种命令，管道支持批量执行不同命令</li><li>原生批量命令是服务端实现，管道需要服务端与客户端共同完成</li></ul><h3 id="管道与事务对比"><a href="#管道与事务对比" class="headerlink" title="管道与事务对比"></a>管道与事务对比</h3><ul><li>事务具有原子性，管道不具有原子性</li><li>管道一次性将多条命令发送到服务器，事务一条一条发，接收到exec命令才执行</li><li>执行事务会阻塞其他命令执行，执行管道则不会</li></ul><h3 id="使用管道注意事项"><a href="#使用管道注意事项" class="headerlink" title="使用管道注意事项"></a>使用管道注意事项</h3><blockquote><ul><li><p>管道中的指令只是会依次执行，不保证原子性；如果发生异常，会继续执行后续指令</p></li><li><p>管道组装的命令个数不能太多，不然客户端阻塞的时间可能过久；服务端也被迫回复一个队列，占用内存</p></li></ul></blockquote><h2 id="Redis发布订阅"><a href="#Redis发布订阅" class="headerlink" title="Redis发布订阅"></a>Redis发布订阅</h2><blockquote><p>了解即可</p></blockquote><h2 id="Redis复制"><a href="#Redis复制" class="headerlink" title="Redis复制"></a>Redis复制</h2><ul><li><p>是什么</p><ul><li><p>主从复制，master以写为主，slave以读为主</p></li><li><p>master数据变化时，自动将新的数据异步同步到其他slave数据库</p></li></ul></li><li><p>能干什么</p><ul><li>读写分离</li><li>容灾恢复</li><li>数据备份</li><li>redis7 主从 配置ubuntu水平扩容支撑高并发（一主多从）</li></ul></li><li><p>如何使用</p><ul><li><p>配从库，不配主库</p></li><li><p>master配置了requirepass参数，需要密码登录</p><ul><li>slave配置masterauth设置校验密码</li></ul></li></ul></li></ul><h3 id="配置方式"><a href="#配置方式" class="headerlink" title="配置方式"></a>配置方式</h3><ul><li>一个master，两个slave<ul><li>（三台虚拟机，每台都安装redis）</li></ul></li><li>拷贝多个redis.conf<ul><li>（redis6379.conf，redis6380.conf，redis6381.conf）</li></ul></li><li>配置文件需要修改的部分</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">port 6380						# 修改端口，6379，6380，6381...</span><br><span class="line">daemonize yes					# redis以守护线程的方式启动，会在后台运行</span><br><span class="line">requirepass	123456				# 设置密码 </span><br><span class="line"></span><br><span class="line"># 其他机器访问</span><br><span class="line"># bind 127.0.0.1 -::1			# 注释掉，bind：将指定的ip设置为redis的对外开放地址。如果设为127.0.0.1的话，只有本机能访问了</span><br><span class="line">protected-mode no				# 关闭保护模式，保护模式下外部网络无法访问</span><br><span class="line"></span><br><span class="line"># 持久化</span><br><span class="line">dir /myredis					# 指定保存位置</span><br><span class="line">dbfilename dump6380.rdb			# RDB文件名</span><br><span class="line">appendonly yes					# 开启AOF（非必选）</span><br><span class="line">appenddirname "appendonlydir"	# 设置AOF文件夹名（非必须）</span><br><span class="line"></span><br><span class="line">pidfile	/var/run/redis_6380.pid	# 该文件中记录了当前redis进程id</span><br><span class="line"></span><br><span class="line"># 日志</span><br><span class="line">loglevel notice					# 日志级别</span><br><span class="line">logfile "/myredis/6380.log"		# 日志位置</span><br><span class="line"></span><br><span class="line"># 从机设置</span><br><span class="line">replicaof 172.26.238.112 6379	# 从机设置主机ip，port（从机必须，主机不需要）</span><br><span class="line">masterauth 123456				# 从机访问主机的密码（从机必须，主机不需要）</span><br></pre></td></tr></table></figure></div><h3 id="一主二仆"><a href="#一主二仆" class="headerlink" title="一主二仆"></a>一主二仆</h3><h4 id="配置文件固定写死"><a href="#配置文件固定写死" class="headerlink" title="配置文件固定写死"></a>配置文件固定写死</h4><ul><li>replicaof 主库IP 主库端口</li><li>配从库不配主库</li><li>先master，后两台slave依次启动</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 主库</span><br><span class="line">redis-server ./redis6379.conf</span><br><span class="line">redis-cli -a 123456</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 从库1，记得指定端口</span><br><span class="line">redis-server ./redis6380.conf</span><br><span class="line">redis-cli -a 123456 -p 6380</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 从库2，记得指定端口</span><br><span class="line">redis-server ./redis6381.conf</span><br><span class="line">redis-cli -a 123456 -p 6381</span><br></pre></td></tr></table></figure></div><ul><li>日志</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 主机日志</span><br><span class="line">vim /myredis/6379.conf</span><br><span class="line"></span><br><span class="line">Synchronization with replica 172.24.252.134:6380 succeeded</span><br><span class="line">Synchronization with replica 172.24.252.150:6381 succeeded</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 从机日志</span><br><span class="line">tail -f /myredis/6380.conf</span><br><span class="line"></span><br><span class="line">Connecting to MASTER 172.24.250.28:6379</span><br><span class="line">MASTER &lt;-&gt; REPLICA sync: receiving streamed RDB from master with EOF to disk</span><br><span class="line">MASTER &lt;-&gt; REPLICA sync: Flushing old data</span><br><span class="line">MASTER &lt;-&gt; REPLICA sync: Loading DB in memory</span><br></pre></td></tr></table></figure></div><ul><li>命令</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info replication</span><br></pre></td></tr></table></figure></div><h4 id="命令控制手动指定"><a href="#命令控制手动指定" class="headerlink" title="命令控制手动指定"></a>命令控制手动指定</h4><ul><li>从机去掉配置项目，3台主机目前都是主机状态，各不从属</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># replicaof 172.26.238.112 6379</span><br></pre></td></tr></table></figure></div><ul><li>从机上执行</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof 主库IP 主库端口</span><br></pre></td></tr></table></figure></div><ul><li>配置：持久稳定</li><li>命令：仅当次生效</li></ul><h4 id="一些问题"><a href="#一些问题" class="headerlink" title="一些问题"></a>一些问题</h4><blockquote><ol><li>从机（salve）只能读不能写</li><li>数据复制：从机第一次一锅端；后续跟随，master写slave跟</li><li>主机shutdown，从机原地待命，等待主机重启归来</li><li>主机重启后，主从关系继续</li><li>从机shutdown，重启后能跟上大部队</li></ol></blockquote><h3 id="薪火相传"><a href="#薪火相传" class="headerlink" title="薪火相传"></a>薪火相传</h3><ul><li>上一个slave可以是下一个slave的master</li><li>中途变更转向：会清除之前的数据，重新建立拷贝最新的</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof 新主库IP 新主库端口</span><br></pre></td></tr></table></figure></div><h3 id="反客为主"><a href="#反客为主" class="headerlink" title="反客为主"></a>反客为主</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof no one</span><br></pre></td></tr></table></figure></div><h3 id="工作流程总结"><a href="#工作流程总结" class="headerlink" title="工作流程总结"></a>工作流程总结</h3><h4 id="slave启动，同步初请"><a href="#slave启动，同步初请" class="headerlink" title="slave启动，同步初请"></a>slave启动，同步初请</h4><ul><li>slave启动成功连接到master后，会发送一个sync命令</li><li>slave首次连接到master，将执行全量复制</li></ul><h4 id="首次连接，全量复制"><a href="#首次连接，全量复制" class="headerlink" title="首次连接，全量复制"></a>首次连接，全量复制</h4><ul><li>master收到sync命令，在后台RDB持久化，同时收集修改命令缓存起来。RDB持久化执行完毕后，将RDB快照和所有缓存命令发送给slave，完成同步</li><li>slave接收到数据，存盘并加载到内存，完成复制</li></ul><h4 id="心跳持续，保持通讯"><a href="#心跳持续，保持通讯" class="headerlink" title="心跳持续，保持通讯"></a>心跳持续，保持通讯</h4><ul><li>master发出ping包，默认周期10秒</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repl-ping-replica-period 10</span><br></pre></td></tr></table></figure></div><h4 id="进入平稳，增量复制"><a href="#进入平稳，增量复制" class="headerlink" title="进入平稳，增量复制"></a>进入平稳，增量复制</h4><ul><li>master继续将新收到的修改命令依次传给slave，完成同步</li></ul><h4 id="从机下线，重连续传"><a href="#从机下线，重连续传" class="headerlink" title="从机下线，重连续传"></a>从机下线，重连续传</h4><ul><li>master和slave都会保存：复制的offset，masterId。offset保存在backlog中。master只会把已复制的offset后面的数据复制给slave，类似断点续传</li></ul><h3 id="复制的缺点"><a href="#复制的缺点" class="headerlink" title="复制的缺点"></a>复制的缺点</h3><ul><li>复制延时，信号衰减<ul><li>写操作在master，同步更新到slave，同步有延时。系统繁忙，延时会更加严重。增加slave会使问题更严重</li></ul></li><li>master挂了<ul><li>master挂了，从机待命，系统只能读取不能写入</li><li>需要人工介入</li></ul></li></ul><h2 id="Redis哨兵"><a href="#Redis哨兵" class="headerlink" title="Redis哨兵"></a>Redis哨兵</h2><h3 id="理论简介"><a href="#理论简介" class="headerlink" title="理论简介"></a>理论简介</h3><ul><li>是什么<ul><li>监控后台master主机是否故障，如果故障，根据投票数自动将一个从库转换为新主库</li></ul></li><li>作用<ul><li>主从监控：监控主从库运行是否正常</li><li>消息通知：将故障转移的结果发送给客户端</li><li>故障转移：如果master异常，进行主从切换，将一个slave作为master</li><li>配置中心：客户端通过哨兵获取当前Redis服务主节点的地址</li></ul></li></ul><h3 id="案例实操"><a href="#案例实操" class="headerlink" title="案例实操"></a>案例实操</h3><ul><li>三个哨兵：用于监控和维护集群，不存放数据</li><li>1主2从：用于数据读取和存放</li></ul><pre class="mermaid">graph TB;
    Client&lt;--&gt;Sentinel集群
    subgraph Sentinel集群;
        direction RL
        Sentinel1----Sentinel2----Sentinel3
    end
    Sentinel集群&lt;--&gt;Redis主从复制
    subgraph Redis主从复制;
        direction TB
        Master&lt;--&gt;Slave1
        Master&lt;--&gt;Slave2
    end</pre><h4 id="配置哨兵"><a href="#配置哨兵" class="headerlink" title="配置哨兵"></a>配置哨兵</h4><ul><li>这里使用了docker</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 哨兵</span><br><span class="line">docker run -d -p 26379:26379 --name sentinel1 --privileged=true -v /dockerApp/sentinel1:/myredis redis redis-server /myredis/sentinel26379.conf --sentinel</span><br><span class="line">docker run -d -p 26380:26380 --name sentinel2 --privileged=true -v /dockerApp/sentinel2:/myredis redis redis-server /myredis/sentinel26380.conf --sentinel</span><br><span class="line">docker run -d -p 26381:26381 --name sentinel3 --privileged=true -v /dockerApp/sentinel3:/myredis redis redis-server /myredis/sentinel26381.conf --sentinel</span><br></pre></td></tr></table></figure></div><ul><li>了解配置</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 重点参数</span><br><span class="line">bind			服务监听地址，用于客户端连接，默认本机ip</span><br><span class="line">daemonize		是否以后台daemon方式运行</span><br><span class="line">protected-mode	安全保护模式</span><br><span class="line">port			端口</span><br><span class="line">logfile			日志文件</span><br><span class="line">pidfile			pid文件路径</span><br><span class="line">dir				工作目录</span><br><span class="line"></span><br><span class="line"># 前三个参数设计要监控的主机，quorum表示最少几个哨兵认为主机宕机，同意故障迁移的票数</span><br><span class="line">sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span><br><span class="line"></span><br><span class="line"># 连接master的密码</span><br><span class="line">sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 其他参数，不怎么需要管，自行差文档</span><br></pre></td></tr></table></figure></div><ul><li>/myredis目录下<code>sentinel26379.conf</code>文件</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bind 0.0.0.0</span><br><span class="line">daemonize yes</span><br><span class="line">protected-mode no</span><br><span class="line">port 26379</span><br><span class="line">logfile "/myredis/sentinel26379.log"</span><br><span class="line">pidfile "/myredis/sentinel26379.pid"</span><br><span class="line">dir /myredis</span><br><span class="line">sentinel monitor mymaster 192.168.114.40 6379 2</span><br><span class="line">sentinel auth-pass mymaster 123456</span><br></pre></td></tr></table></figure></div><h4 id="配置主从机"><a href="#配置主从机" class="headerlink" title="配置主从机"></a>配置主从机</h4><ul><li>使用了docker</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 主机从机</span><br><span class="line">docker run -d -p 6379:6379 --name redis1 --privileged=true -v /dockerApp/redis1:/myredis -v /dockerApp/redis1/data:/data redis redis-server /myredis/redis6379.conf</span><br><span class="line">	</span><br><span class="line">docker run -d -p 6380:6380 --name redis2 --privileged=true -v /dockerApp/redis2:/myredis -v /dockerApp/redis2/data:/data redis redis-server /myredis/redis6380.conf</span><br><span class="line">	</span><br><span class="line">docker run -d -p 6381:6381 --name redis3 --privileged=true -v /dockerApp/redis3:/myredis -v /dockerApp/redis2/data:/data redis redis-server /myredis/redis6381.conf</span><br></pre></td></tr></table></figure></div><ul><li>主机从机配置<code>redsi6379.conf</code></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">port 6379</span><br><span class="line">daemonize no # 为让redis不退出，必须有个前台程序</span><br><span class="line">requirepass	123456</span><br><span class="line"></span><br><span class="line"># bind 127.0.0.1 -::1	# 注释掉</span><br><span class="line">protected-mode no</span><br><span class="line"></span><br><span class="line">dir /myredis</span><br><span class="line">dbfilename dump6379.rdb</span><br><span class="line">appendonly yes</span><br><span class="line">appenddirname "appendonlydir"</span><br><span class="line"></span><br><span class="line">pidfile	/myredis/redis6379.pid</span><br><span class="line">loglevel notice</span><br><span class="line">logfile "/myredis/6379.log"</span><br><span class="line"></span><br><span class="line"># 主从机都设置，因为主机可能改变</span><br><span class="line">masterauth 123456 </span><br><span class="line"></span><br><span class="line"># 从机设置</span><br><span class="line">replicaof 192.168.114.40 6379</span><br></pre></td></tr></table></figure></div><h4 id="启动所有机器"><a href="#启动所有机器" class="headerlink" title="启动所有机器"></a>启动所有机器</h4><ul><li>先启动主从，接着启动哨兵</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 哨兵日志</span><br><span class="line">Sentinel ID is 24f3285df6c3b1019b8bcfc9bcd7132a5aa1363b</span><br><span class="line"></span><br><span class="line">+monitor master mymaster 192.168.114.40 6379 quorum 2</span><br><span class="line">+slave slave 172.17.0.1:6380 172.17.0.1 6380 @ mymaster 192.168.114.40 6379</span><br><span class="line">+slave slave 172.17.0.1:6381 172.17.0.1 6381 @ mymaster 192.168.114.40 6379</span><br><span class="line"></span><br><span class="line">+sentinel sentinel 15a1dd9afaacb46b89486a9e8417354d66b14563 172.17.0.6 26380 @ mymaster 192.168.114.40 6379</span><br><span class="line">+sentinel sentinel 3f3c725be2765afb4a1afe807652c8b57056d0aa 172.17.0.7 26381 @ mymaster 192.168.114.40 6379</span><br></pre></td></tr></table></figure></div><h4 id="主机挂掉"><a href="#主机挂掉" class="headerlink" title="主机挂掉"></a>主机挂掉</h4><ul><li>手动关掉6379，模拟挂掉了</li><li>剩下两台机器自动选出了新的master<ul><li>这里info replication发现，6380成为了master</li></ul></li><li>查看哨兵的日志</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+sdown master mymaster 192.168.114.40 6379</span><br><span class="line">+odown master mymaster 192.168.114.40 6379 #quorum 2/2</span><br><span class="line">+new-epoch 1</span><br><span class="line">+vote-for-leader 24f3285df6c3b1019b8bcfc9bcd7132a5aa1363b 1</span><br><span class="line"></span><br><span class="line">+switch-master mymaster 192.168.114.40 6379 172.17.0.1 6380</span><br><span class="line">+slave slave 172.17.0.1:6381 172.17.0.1 6381 @ mymaster 172.17.0.1 6380</span><br><span class="line">+slave slave 192.168.114.40:6379 192.168.114.40 6379 @ mymaster 172.17.0.1 6380 # 6379变为slave，即使回来了依然是slave</span><br></pre></td></tr></table></figure></div><ul><li>6379恢复，会变成slave，不会冲突</li></ul><h3 id="一些问题-1"><a href="#一些问题-1" class="headerlink" title="一些问题"></a>一些问题</h3><ul><li>主机刚挂掉，从机get时，会报</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: Broken pipe</span><br></pre></td></tr></table></figure></div><blockquote><p>意思是：对端的管道断开了，远端把这个读/写管道关闭了，你无法继续对这个管道进行读写操作</p></blockquote><ul><li>配置自动修改<ul><li>观察redis6379.conf, redis6380.conf可以发现，文件的内容被动态修改了</li><li>配置文件会被sentinel动态更改</li></ul></li><li>哨兵可以监控多个主机<ul><li>自行去官网看文档</li></ul></li></ul><h3 id="哨兵运行流程和选举原理"><a href="#哨兵运行流程和选举原理" class="headerlink" title="哨兵运行流程和选举原理"></a>哨兵运行流程和选举原理</h3><ul><li>三个哨兵，一主二从，正常运行中</li><li>SDown主观下线<ul><li>单个哨兵自己主观上。发送PING心跳一段时间没有收到合法回复</li><li>配置文件：<code>down-after-milliseconds</code>（默认30s）</li></ul></li><li>ODown客观下线<ul><li>多个哨兵达成一致意见</li><li>配置文件：<code>sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</code></li></ul></li><li>选出领导者哨兵<ul><li>主节点被判断客观下线，各个哨兵协商选出领导者。</li><li>由领导者进行failover（故障转移）</li></ul></li><li>领导者如何选择出来的？<ul><li>Raft算法</li><li>先到先得，哨兵A向哨兵B发送成为领导者的申请。</li><li>如果B没同意过别人，就同意A成为领导者。</li></ul></li><li>领导者进行故障转移，并选出新的master<ul><li>新主登基：某一个slave被选为master<ul><li>replica priority(权限)&gt;replication offset(复制偏移量)&gt;Run ID</li></ul></li><li>群臣俯首<ul><li>哨兵领导者对新master发送命令：slaveof no one，提升为master节点</li><li>哨兵领导者对其他slave发送命令：slaveof，成为新的slave节点</li></ul></li><li>旧主拜服<ul><li>老master上线。哨兵领导者对其降级为slave，恢复工作</li></ul></li></ul></li></ul><h3 id="哨兵使用建议"><a href="#哨兵使用建议" class="headerlink" title="哨兵使用建议"></a>哨兵使用建议</h3><ul><li>哨兵数量应为多个</li><li>哨兵数量最好为奇数，好投票</li><li>哨兵节点配置最好一致</li><li>哨兵节点性能最好一致</li><li>哨兵节点如果部署在Docker，要注意端口映射</li><li>哨兵+主从复制，并不能保证数据不丢失</li></ul><h2 id="Redis集群"><a href="#Redis集群" class="headerlink" title="Redis集群"></a>Redis集群</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><ul><li>什么是集群<ul><li>数据量过大，单Master的复制集难以承担</li><li>需要水平扩展，每个复制集只负责存储整个数据集的一部分</li></ul></li></ul><pre class="mermaid">graph LR;
    Clinets-write--&gt;M1
    Clinets-write--&gt;M2
    Clinets-write--&gt;M3
    subgraph Master
        M1
        M2
        M3
    end
    subgraph Slave
        S1
        S2
        S3
    end
    Master --&gt; Slave
    S1--&gt;Clinets-read
    S2--&gt;Clinets-read
    S3--&gt;Clinets-read</pre><ul><li>能干什么<ul><li>Redis集群支持多个Master，每个Master又可以挂载多个Slave<ul><li>读写分离</li><li>支持数据高可用</li><li>支持海量数据读写存储</li></ul></li><li>集群自带sentinel的故障转移机制，无需配置哨兵</li><li>客户端与Redis节点连接时，只需任意连接集群中一个可用节点</li><li>槽位slot负责分配到各个物理服务节点，由对应的集群来负责维护节点、插槽和数据之间的关系</li></ul></li></ul><h3 id="集群算法-分片-槽位slot"><a href="#集群算法-分片-槽位slot" class="headerlink" title="集群算法-分片-槽位slot"></a>集群算法-分片-槽位slot</h3><ul><li>官网出处<ul><li><a class="link" target="_blank" rel="noopener" href="https://redis.io/docs/reference/cluster-spec/#overview-of-redis-cluster-main-components">https://redis.io/docs/reference/cluster-spec/#overview-of-redis-cluster-main-components <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul></li></ul><h4 id="槽位slot"><a href="#槽位slot" class="headerlink" title="槽位slot"></a>槽位slot</h4><ul><li>Redis集群没有使用一致性hash，而是引入了哈希槽的概念</li><li>Redis集群有16384个哈希槽，每个key通过<code>CRC16(key) mod 16384</code>来决定放哪个槽</li></ul><h4 id="分片"><a href="#分片" class="headerlink" title="分片"></a>分片</h4><ul><li>我们会将存储的数据分散到多台redis机器上，称为分片</li><li>每个Redis实例都被认为时整个数据的一个分片</li><li>比如有三个节点，0-16383，则分片：<ul><li>0-5460</li><li>5461-10922</li><li>10923-16383</li></ul></li></ul><h4 id="分片和槽位的优势"><a href="#分片和槽位的优势" class="headerlink" title="分片和槽位的优势"></a>分片和槽位的优势</h4><ul><li>方便扩容和缩容<ul><li>假如有三台A,B,C</li><li>比如移除A，则需要将A中的槽位匀一部分到B和C</li></ul></li><li>一个节点将哈希槽移动到另一个节点不会停止服务<ul><li>不会造成集群不可用</li></ul></li></ul><h4 id="槽位映射的三种解决方案"><a href="#槽位映射的三种解决方案" class="headerlink" title="槽位映射的三种解决方案"></a>槽位映射的三种解决方案</h4><h5 id="哈希取余分区（小厂）"><a href="#哈希取余分区（小厂）" class="headerlink" title="哈希取余分区（小厂）"></a>哈希取余分区（小厂）</h5><ul><li><code>hash(key)/N</code></li><li>优缺点<ul><li>优点：简单粗暴，让固定一部分请求落在同一台服务器上</li><li>缺点：扩容和缩容后，映射需要重新计算，发生很大变化</li></ul></li></ul><h5 id="一致性哈希分区"><a href="#一致性哈希分区" class="headerlink" title="一致性哈希分区"></a>一致性哈希分区</h5><ul><li><p>目的：服务器个数发生变化，尽量少影响映射关系</p></li><li><p>三大步骤</p><ol><li>一致性哈希环</li></ol><ul><li>一致性哈希对2^32^取模，形成一个虚拟圆环</li><li>[0,2^32^-1]，0=2^32^-1，构成hash环</li></ul><ol start="2"><li>服务器IP节点映射</li></ol><ul><li>将各IP映射到环上某位置，<code>hash(IP)</code></li></ul><ol start="3"><li>key落到各服务器规则</li></ol><ul><li><code>hash(key)</code>计算数据在环上的位置</li><li>顺时针走遇到的第一个服务器，就是应该存储的服务器</li></ul></li><li><p>优缺点</p><ul><li>优点：有一定容错性，有节点宕机，依然可以继续存储。扩展性好。</li><li>缺点：节点太少分布不均匀，有数据倾斜问题</li></ul></li></ul><h5 id="哈希槽分区"><a href="#哈希槽分区" class="headerlink" title="哈希槽分区"></a>哈希槽分区</h5><ul><li><p><code>CRC16(key) % 16384</code></p></li><li><p>[0,2^14^-1]形成hash slot空间</p></li><li><p>在数据和节点之间加了一层，称为哈希槽</p></li><li><p>槽会分配给集群中所有主节点，分配策略没有要求</p></li></ul><h3 id="一些面试问题"><a href="#一些面试问题" class="headerlink" title="一些面试问题"></a>一些面试问题</h3><blockquote><p><strong>为什么最大槽数是16384？</strong></p><ul><li><p><a class="link" target="_blank" rel="noopener" href="https://github.com/redis/redis/issues/2576">https://github.com/redis/redis/issues/2576 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></li><li><p>如果槽位是65536，发送心跳的消息头达8k，过于庞大</p><ul><li>消息头中最占空间的是<code>myslots[CLUSTER_SLOTS/8]</code><ul><li>槽位65536，大小为65536/8/1024=8kb</li><li>槽位16384，大小为16384/8/1024=2kb</li></ul></li><li>每秒钟，redis节点需要发送一定数量的PING包，如果槽位65536，太大了浪费带宽</li></ul></li><li><p>redis集群主节点数量基本不会超过1000个（网络杜塞），对1000以内的redis集群，16384个槽位够了</p></li><li><p>redis主节点负责的哈希槽是通过bitmap保存的。如果节点数少，哈希槽多，压缩率会很低</p></li></ul></blockquote><blockquote><p><strong>集群可能会写丢失</strong></p><ul><li>Redis集群不保证<code>数据强一致性</code>，意味着特定条件下，可能会丢掉一些写入请求命令</li></ul></blockquote><h3 id="集群案例"><a href="#集群案例" class="headerlink" title="集群案例"></a>集群案例</h3><ul><li>三主三从</li><li>具体的分配是自动来的，未必真的长这样</li></ul><pre class="mermaid">graph LR;
    subgraph master
        6381
        6383
        6385
    end
    subgraph slave
        6382
        6384
        6386
    end
    6381--&gt;6382
    6383--&gt;6384
    6385--&gt;6386</pre><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><ul><li>/myreids/cluster6381.conf</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">bind 0.0.0.0</span><br><span class="line">daemonize yes</span><br><span class="line">protected-mode no</span><br><span class="line">port 6381</span><br><span class="line">logfile "/myredis/cluster6381.log"</span><br><span class="line">pidfile "/myredis/cluster6381.pid"</span><br><span class="line">dir /myredis</span><br><span class="line">dbfilename dump6381.rdb</span><br><span class="line">appendonly yes</span><br><span class="line">appendfilename "appendonly6381.aof"</span><br><span class="line">requirepass 123456</span><br><span class="line">masterauth 123456</span><br><span class="line"></span><br><span class="line">cluster-enabled yes						# 集群是否开启</span><br><span class="line">cluster-config-file nodes-6381.conf		# 集群配置文件</span><br><span class="line">cluster-node-timeout 5000				# 集群超时时间</span><br></pre></td></tr></table></figure></div><h4 id="启动6台redis主机"><a href="#启动6台redis主机" class="headerlink" title="启动6台redis主机"></a>启动6台redis主机</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-server /myreids/cluster6381.conf</span><br><span class="line">...</span><br><span class="line">redis-server /myreids/cluster6386.conf</span><br></pre></td></tr></table></figure></div><h4 id="通过redis-cli为6台机器构建集群关系"><a href="#通过redis-cli为6台机器构建集群关系" class="headerlink" title="通过redis-cli为6台机器构建集群关系"></a>通过redis-cli为6台机器构建集群关系</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 123456 --cluster create --cluster-replicas 1 &lt;地址1:端口1&gt; &lt;地址2:端口2&gt; &lt;地址3:端口3&gt; &lt;地址4:端口4&gt; &lt;地址5:端口5&gt; &lt;地址6:端口6&gt;</span><br></pre></td></tr></table></figure></div><ul><li><p>–cluster create：表示集群形式创建</p></li><li><p>–cluster-replicas 1：每个master一个slave</p></li><li><p>集群联通成功后，产生nodes-xxxx.conf配置文件</p></li></ul><h4 id="检验集群关系"><a href="#检验集群关系" class="headerlink" title="检验集群关系"></a>检验集群关系</h4><ul><li>info replication</li><li>cluster nodes：查看集群节点信息</li></ul><h4 id="读写数据"><a href="#读写数据" class="headerlink" title="读写数据"></a>读写数据</h4><ul><li>一定注意槽位的范围，需要路由到位（加参数-c）</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 111111 -p 6381 -c</span><br></pre></td></tr></table></figure></div><ul><li>查看某个key属于的槽位</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cluster keyslot &lt;key&gt;</span><br></pre></td></tr></table></figure></div><h3 id="主从容错切换迁移案例"><a href="#主从容错切换迁移案例" class="headerlink" title="主从容错切换迁移案例"></a>主从容错切换迁移案例</h3><ul><li><p>6381宕机，cluster nodes查看</p><ul><li>直接从机6382上位成为master</li></ul></li><li><p>6381恢复，cluster nodes查看</p><ul><li>江山易主，变成slave，master是6382</li></ul></li><li><p>6381，6382主从关系颠倒，如果想恢复原有关系（故障转移）</p></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cluster failover</span><br></pre></td></tr></table></figure></div><h3 id="集群扩容"><a href="#集群扩容" class="headerlink" title="集群扩容"></a>集群扩容</h3><pre class="mermaid">graph LR;
    subgraph master
        6381
        6383
        6385
        6387-新
    end
    subgraph slave
        6382
        6384
        6386
        6388-新
    end
    6381--&gt;6382
    6383--&gt;6384
    6385--&gt;6386
    6387-新--&gt;6388-新</pre><ul><li>新启动redis实例，此时还不在集群中</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-server /myreids/cluster6387.conf</span><br><span class="line">redis-server /myreids/cluster6388.conf</span><br></pre></td></tr></table></figure></div><ul><li>将新增的6387作为master节点加入原有集群<ul><li>6381相当于原来集群里的引路人</li></ul></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 123456 --cluster add-node &lt;地址7:6387&gt; &lt;地址1:6381&gt;</span><br></pre></td></tr></table></figure></div><ul><li>检查集群情况<ul><li>发现还未为6387分配槽位</li></ul></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 123456 --cluster check &lt;地址1:6381&gt;</span><br></pre></td></tr></table></figure></div><ul><li>重新分配槽位<ul><li>How many slots do you want to move? <code>4096</code></li><li>What is the receving node ID: <code>&lt;6387节点的id&gt;</code></li><li>Source node #1: <code>all</code></li><li>分完再查看集群情况，可以看到6387被分配了许多段的槽位</li></ul></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 123456 --cluster reshard &lt;地址1:6381&gt;</span><br></pre></td></tr></table></figure></div><ul><li>将新增的6388作为slave节点加入原有集群</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 123456 --cluster add-node &lt;地址8:6388&gt; &lt;地址7:6387&gt; --cluster-slave --cluster-master-id &lt;6387主机节点id&gt;</span><br></pre></td></tr></table></figure></div><h3 id="集群缩容"><a href="#集群缩容" class="headerlink" title="集群缩容"></a>集群缩容</h3><ul><li>清除master节点6388</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 获得6388，6387，6381的id</span><br><span class="line">redis-cli -a 123456 --cluster check &lt;地址1:6381&gt;</span><br><span class="line"></span><br><span class="line"># 删除6388节点</span><br><span class="line">redis-cli -a 123456 --cluster del-node &lt;地址8:6388&gt; &lt;6388节点的id&gt;</span><br></pre></td></tr></table></figure></div><ul><li>清除6387槽号，本例中，重新分配给6381<ul><li>How many slots do you want to move? <code>4096</code></li><li>What is the receving node ID: <code>&lt;6381节点的id&gt;</code></li><li>Source node #1: <code>&lt;6387节点的id&gt;</code></li><li>Source node #2: <code>done</code></li></ul></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 123456 --cluster reshard &lt;地址1:6381&gt;</span><br></pre></td></tr></table></figure></div><ul><li><p>此时6387由6381变成slave，挂在6381下面</p></li><li><p>删除slave节点6387</p></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 123456 --cluster del-node &lt;地址7:6387&gt; &lt;6387节点的id&gt;</span><br></pre></td></tr></table></figure></div><ul><li>恢复完毕，三主三从</li></ul><h3 id="集群常用操作和CRC16算法分析"><a href="#集群常用操作和CRC16算法分析" class="headerlink" title="集群常用操作和CRC16算法分析"></a>集群常用操作和CRC16算法分析</h3><h4 id="通识占位符"><a href="#通识占位符" class="headerlink" title="通识占位符"></a>通识占位符</h4><ul><li>不在同一个slot槽位下的键值无法使用mset，mget等多键操作</li><li>通识占位符登场</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 会分配到同一个槽位上，具体用什么占位符自定义</span><br><span class="line">mset k1{z} v1 k2{z} v2 k3{z} v3</span><br><span class="line"></span><br><span class="line">mget k1{z} k2{z} k3{z}</span><br></pre></td></tr></table></figure></div><h4 id="常用配置-x2F-命令"><a href="#常用配置-x2F-命令" class="headerlink" title="常用配置/命令"></a>常用配置/命令</h4><ul><li>集群是否完整才能对外提供服务<ul><li>原本三主三从。二主三从（可以服务）；二主二从（集群不完整了，不服务）</li></ul></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 配置文件中</span><br><span class="line">cluster-require-full-coverage yes</span><br></pre></td></tr></table></figure></div><ul><li>查看槽位是否被占用<ul><li>1：被占用</li><li>0：没被占用</li></ul></li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cluster countkeysinslot 12706</span><br></pre></td></tr></table></figure></div><ul><li>查看键应该存在哪个槽位上</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cluster keyslot &lt;key&gt;</span><br></pre></td></tr></table></figure></div><h2 id="SpringBoot整合Redis"><a href="#SpringBoot整合Redis" class="headerlink" title="SpringBoot整合Redis"></a>SpringBoot整合Redis</h2><h3 id="总体概述"><a href="#总体概述" class="headerlink" title="总体概述"></a>总体概述</h3><ul><li>jedis<ul><li>相当于jdbc</li></ul></li><li>lettuce<ul><li>对jedis进一步优化</li></ul></li><li>RedisTemplate（推荐使用）<ul><li>进一步对lettuce做了封装</li></ul></li></ul><h3 id="集成jedis"><a href="#集成jedis" class="headerlink" title="集成jedis"></a>集成jedis</h3><ul><li>jedis client是Redis官网推荐的，面向java的客户端，实现了对各类API的封装</li><li>引入依赖</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;redis.clients&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jedis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></div><ul><li>使用</li></ul><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得连接</span></span><br><span class="line"><span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">"192.168.114.40"</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定密码</span></span><br><span class="line">jedis.auth(<span class="string">"123456"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问redis</span></span><br><span class="line">System.out.println(jedis.ping());</span><br><span class="line"></span><br><span class="line"><span class="comment">// keys</span></span><br><span class="line">Set&lt;String&gt; keys = jedis.keys(<span class="string">"*"</span>);</span><br><span class="line"><span class="type">long</span> <span class="variable">ttl</span> <span class="operator">=</span> jedis.ttl(<span class="string">"k1"</span>);</span><br><span class="line"><span class="type">long</span> <span class="variable">r1</span> <span class="operator">=</span> jedis.expire(<span class="string">"k1"</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// string</span></span><br><span class="line"><span class="type">String</span> <span class="variable">k1</span> <span class="operator">=</span> jedis.get(<span class="string">"k1"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// list</span></span><br><span class="line"><span class="type">long</span> <span class="variable">r2</span> <span class="operator">=</span> jedis.lpush(<span class="string">"l1"</span>, <span class="string">"11"</span>, <span class="string">"12"</span>, <span class="string">"13"</span>);</span><br><span class="line">List&lt;String&gt; l1 = jedis.lrange(<span class="string">"l1"</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 其他api自行探索</span></span><br></pre></td></tr></table></figure></div><h3 id="集成lettuce"><a href="#集成lettuce" class="headerlink" title="集成lettuce"></a>集成lettuce</h3><ul><li>使用jedis每次都需要new一个<ul><li>需要”池化技术“</li></ul></li><li>SpringBoot2.0之后，都默认使用Lettuce这个客户端连接Redis服务器<ul><li>Lettuce底层使用的是Netty</li></ul></li><li>引入依赖</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.lettuce&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></div><ul><li>使用</li></ul><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用构建器链式编程来build我们的RedisURI</span></span><br><span class="line"><span class="type">RedisURI</span> <span class="variable">uri</span> <span class="operator">=</span> RedisURI.builder()</span><br><span class="line">        .withHost(<span class="string">"192.168.114.40"</span>)</span><br><span class="line">        .withPort(<span class="number">6379</span>)</span><br><span class="line">        .withPassword(<span class="string">"123456"</span>)</span><br><span class="line">        .build();</span><br><span class="line"><span class="comment">// 创建连接客户端</span></span><br><span class="line"><span class="type">RedisClient</span> <span class="variable">redisClient</span> <span class="operator">=</span> RedisClient.create(uri);</span><br><span class="line"><span class="comment">// 获得连接</span></span><br><span class="line">StatefulRedisConnection&lt;String, String&gt; connect = redisClient.connect();</span><br><span class="line"><span class="comment">// 创建操作command</span></span><br><span class="line">RedisCommands&lt;String, String&gt; commands = connect.sync();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 业务逻辑</span></span><br><span class="line">List&lt;String&gt; l1 = commands.lrange(<span class="string">"l1"</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">System.out.println(l1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 各种关闭，释放资源</span></span><br><span class="line">connect.close();</span><br><span class="line">redisClient.shutdown();</span><br></pre></td></tr></table></figure></div><h3 id="集成RedisTemplate集成"><a href="#集成RedisTemplate集成" class="headerlink" title="集成RedisTemplate集成"></a>集成RedisTemplate集成</h3><ul><li>前两种了解即可，这个必须熟悉</li><li>导入依赖</li></ul><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--SpringBoot与Redis整合--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--swagger2--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div><ul><li><code>spring-boot-starter-data-redis</code>已帮我们引入了<code>lettuce</code></li></ul><h4 id="连接单机"><a href="#连接单机" class="headerlink" title="连接单机"></a>连接单机</h4><ul><li>配置</li></ul><div class="highlight-container" data-rel="Properties"><figure class="iseeu highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">7777</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">redis7_study</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment"># ========================logging=====================</span></span><br><span class="line"><span class="attr">logging.level.root</span>=<span class="string">info</span></span><br><span class="line"><span class="attr">logging.level.com.example.myredis</span>=<span class="string">info</span></span><br><span class="line"><span class="attr">logging.pattern.console</span>=<span class="string">%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger- %msg%n</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging.file.name</span>=<span class="string">C:/myredis/redis7_study.log</span></span><br><span class="line"><span class="attr">logging.pattern.file</span>=<span class="string">%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger- %msg%n</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment"># ========================swagger=====================</span></span><br><span class="line"><span class="comment">#在springboot2.6.X结合swagger2.9.X会提示documentationPluginsBootstrapper空指针异常，</span></span><br><span class="line"><span class="comment">#原因是在springboot2.6.X中将SpringMVC默认路径匹配策略从AntPathMatcher更改为PathPatternParser，</span></span><br><span class="line"><span class="comment"># 导致出错，解决办法是matching-strategy切换回之前ant_path_matcher</span></span><br><span class="line"><span class="attr">spring.swagger2.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">spring.mvc.pathmatch.matching-strategy</span>=<span class="string">ant_path_matcher</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment"># ========================redis单机=====================</span></span><br><span class="line"><span class="attr">spring.redis.database</span>=<span class="string">0</span></span><br><span class="line"><span class="attr">spring.redis.host</span>=<span class="string">192.168.114.40</span></span><br><span class="line"><span class="attr">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="attr">spring.redis.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-active</span>=<span class="string">8</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-wait</span>=<span class="string">-1ms</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-idle</span>=<span class="string">8</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.min-idle</span>=<span class="string">0</span></span><br></pre></td></tr></table></figure></div><ul><li>配置类</li></ul><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> {</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(LettuceConnectionFactory lettuceConnectionFactory)</span> {</span><br><span class="line">        RedisTemplate&lt;String,Object&gt; redisTemplate = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        redisTemplate.setConnectionFactory(lettuceConnectionFactory);</span><br><span class="line">        <span class="comment">//设置key序列化方式string</span></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        <span class="comment">//设置value的序列化方式json，使用GenericJackson2JsonRedisSerializer替换默认序列化</span></span><br><span class="line">        redisTemplate.setValueSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>());</span><br><span class="line"></span><br><span class="line">        redisTemplate.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        redisTemplate.setHashValueSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>());</span><br><span class="line"></span><br><span class="line">        redisTemplate.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span></span><br><span class="line">{</span><br><span class="line">    <span class="meta">@Value("${spring.swagger2.enabled}")</span></span><br><span class="line">    <span class="keyword">private</span> Boolean enabled;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">createRestApi</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .enable(enabled)</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">"com.example.myredis"</span>)) <span class="comment">//你自己的package</span></span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">"springboot利用swagger2构建api接口文档 "</span>+<span class="string">"\t"</span>+ DateTimeFormatter.ofPattern(<span class="string">"yyyy-MM-dd"</span>).format(LocalDateTime.now()))</span><br><span class="line">                .description(<span class="string">"springboot+redis整合,有问题给管理员发邮件:1625378509@qq.com"</span>)</span><br><span class="line">                .version(<span class="string">"1.0"</span>)</span><br><span class="line">                .termsOfServiceUrl(<span class="string">"https://www.atguigu.com/"</span>)</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div><ul><li>使用</li></ul><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ORDER_KEY</span> <span class="operator">=</span> <span class="string">"ord:"</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> ORDER_KEY + keyId;</span><br><span class="line">redisTemplate.opsForValue().set(key, value);</span><br><span class="line"></span><br><span class="line">redisTemplate.opsForValue().get(ORDER_KEY + keyId);</span><br></pre></td></tr></table></figure></div><ul><li>问题</li></ul><blockquote><p>key和value都是通过Spring提供的Serialize序列化到数据库的</p><ul><li><p><code>RedisTemplate</code>默认使用<code>JdkSerializationRedisSerializer</code></p></li><li><p><code>StringRedisTemplate</code>默认使用<code>StringRedisSerializer</code></p></li></ul></blockquote><blockquote><p>redis-cli中使用中文</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 123456 -p 6379 --raw</span><br></pre></td></tr></table></figure></div></blockquote><h4 id="连接集群"><a href="#连接集群" class="headerlink" title="连接集群"></a>连接集群</h4></div><div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8"><div class="article-copyright-info-container"><ul><li><strong>标题:</strong> Redis基础</li><li><strong>作者:</strong> 布鸽不鸽</li><li><strong>创建于 :</strong> 2023-08-28 18:44:58</li><li><strong>更新于 :</strong> 2023-08-28 18:46:36</li><li><strong>链接:</strong> https://xuedongyun.cn//post/26216/</li><li><strong>版权声明: </strong>本文章采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a> 进行许可。</li></ul></div></div><div class="recommended-article px-2 sm:px-6 md:px-8"><div class="recommended-desktop"><div class="recommended-article-header text-xl md:text-3xl font-bold mt-10"><i aria-hidden="true"></i><span>推荐阅读</span></div><div class="recommended-article-group"><a class="recommended-article-item" target="_blank" href="//post/25055/" title="Redis实战系列（4）：分布式锁" rel="bookmark noopener"><img src="/images/wallhaven-wqery6-light.webp" alt="Redis实战系列（4）：分布式锁" class="!max-w-none"> <span class="title">Redis实战系列（4）：分布式锁</span> </a><a class="recommended-article-item" target="_blank" href="//post/33842/" title="RabbitMQ基础" rel="bookmark noopener"><img src="/images/wallhaven-wqery6-light.webp" alt="RabbitMQ基础" class="!max-w-none"> <span class="title">RabbitMQ基础</span> </a><a class="recommended-article-item" target="_blank" href="//post/50833/" title="2023阿里灵犀互娱春招算法题" rel="bookmark noopener"><img src="/images/wallhaven-wqery6-light.webp" alt="2023阿里灵犀互娱春招算法题" class="!max-w-none"> <span class="title">2023阿里灵犀互娱春招算法题</span></a></div></div><div class="recommended-mobile"><div class="recommended-article-header text-xl md:text-3xl font-bold mt-10"><i aria-hidden="true"></i><span>推荐阅读</span></div><div class="recommended-article-group"><a class="recommended-article-item" target="_blank" href="//post/25055/" title="Redis实战系列（4）：分布式锁" rel="bookmark noopener"><img src="/images/wallhaven-wqery6-light.webp" alt="Redis实战系列（4）：分布式锁" class="!max-w-none"> <span class="title">Redis实战系列（4）：分布式锁</span> </a><a class="recommended-article-item" target="_blank" href="//post/33842/" title="RabbitMQ基础" rel="bookmark noopener"><img src="/images/wallhaven-wqery6-light.webp" alt="RabbitMQ基础" class="!max-w-none"> <span class="title">RabbitMQ基础</span></a></div></div></div><div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8"><div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2"><a class="prev" rel="prev" href="/post/33842/"><span class="left arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-left"></i> </span><span class="title flex justify-center items-center"><span class="post-nav-title-item">RabbitMQ基础</span> <span class="post-nav-item">上一篇</span></span></a></div><div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2"><a class="next" rel="next" href="/post/17650/"><span class="title flex justify-center items-center"><span class="post-nav-title-item">Java中的IO流</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-right"></i></span></a></div></div><div class="comment-container px-2 sm:px-6 md:px-8 pb-8"><div class="comments-container mt-10 w-full"><div id="comment-anchor" class="w-full h-2.5"></div><div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">评论</div><div id="waline"></div><script type="module" data-swup-reload-script>import { init } from '/js/libs/waline.mjs';

      function loadWaline() {
        init({
          el: '#waline',
          serverURL: 'https://comment.xuedongyun.cn/',
          lang: 'zh-CN',
          dark: 'body[class~="dark-mode"]',
          reaction: false,
          requiredMeta: ['nick', 'mail'],
          emoji: [],
          recaptchaV3Key: "wasd",
          
        });
      }

      if (typeof swup !== 'undefined') {
        loadWaline();
      } else {
        window.addEventListener('DOMContentLoaded', loadWaline);
      }</script></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><div class="toc-title">目录</div><div class="page-title">Redis基础</div><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0"><span class="nav-text">Redis入门概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-text">是什么</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%83%BD%E5%B9%B2%E4%BB%80%E4%B9%88"><span class="nav-text">能干什么</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8A%BF"><span class="nav-text">优势</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis7%E6%96%B0%E7%89%B9%E6%80%A7"><span class="nav-text">Redis7新特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis7%E5%AE%89%E8%A3%85%E7%9B%B8%E5%85%B3"><span class="nav-text">Redis7安装相关</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis%E5%8D%81%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-text">Redis十大数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E4%BD%93%E6%A6%82%E6%8B%AC"><span class="nav-text">总体概括</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%9F%A5%E8%AF%A2"><span class="nav-text">命令查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8key%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="nav-text">常用key操作命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%91%BD%E4%BB%A4%E5%8F%8A%E8%90%BD%E5%9C%B0%E5%BA%94%E7%94%A8"><span class="nav-text">数据类型命令及落地应用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-text">Redis持久化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RDB%E6%96%B9%E5%BC%8F"><span class="nav-text">RDB方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AOF%E6%96%B9%E5%BC%8F"><span class="nav-text">AOF方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RDB-AOF%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-text">RDB-AOF混合持久化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis%E4%BA%8B%E5%8A%A1"><span class="nav-text">Redis事务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis%E4%BA%8B%E5%8A%A1vs%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1"><span class="nav-text">Redis事务vs数据库事务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="nav-text">使用案例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis%E7%AE%A1%E9%81%93"><span class="nav-text">Redis管道</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%A1%E9%81%93%E4%B8%8E%E5%8E%9F%E7%94%9F%E6%89%B9%E9%87%8F%E5%91%BD%E4%BB%A4%E5%AF%B9%E6%AF%94"><span class="nav-text">管道与原生批量命令对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%A1%E9%81%93%E4%B8%8E%E4%BA%8B%E5%8A%A1%E5%AF%B9%E6%AF%94"><span class="nav-text">管道与事务对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%AE%A1%E9%81%93%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-text">使用管道注意事项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85"><span class="nav-text">Redis发布订阅</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis%E5%A4%8D%E5%88%B6"><span class="nav-text">Redis复制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="nav-text">配置方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E4%B8%BB%E4%BA%8C%E4%BB%86"><span class="nav-text">一主二仆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%96%AA%E7%81%AB%E7%9B%B8%E4%BC%A0"><span class="nav-text">薪火相传</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E5%AE%A2%E4%B8%BA%E4%B8%BB"><span class="nav-text">反客为主</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E6%80%BB%E7%BB%93"><span class="nav-text">工作流程总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E5%88%B6%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="nav-text">复制的缺点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis%E5%93%A8%E5%85%B5"><span class="nav-text">Redis哨兵</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%90%86%E8%AE%BA%E7%AE%80%E4%BB%8B"><span class="nav-text">理论简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D"><span class="nav-text">案例实操</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98-1"><span class="nav-text">一些问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%A8%E5%85%B5%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%92%8C%E9%80%89%E4%B8%BE%E5%8E%9F%E7%90%86"><span class="nav-text">哨兵运行流程和选举原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%A8%E5%85%B5%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="nav-text">哨兵使用建议</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis%E9%9B%86%E7%BE%A4"><span class="nav-text">Redis集群</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E7%AE%97%E6%B3%95-%E5%88%86%E7%89%87-%E6%A7%BD%E4%BD%8Dslot"><span class="nav-text">集群算法-分片-槽位slot</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98"><span class="nav-text">一些面试问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E6%A1%88%E4%BE%8B"><span class="nav-text">集群案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E4%BB%8E%E5%AE%B9%E9%94%99%E5%88%87%E6%8D%A2%E8%BF%81%E7%A7%BB%E6%A1%88%E4%BE%8B"><span class="nav-text">主从容错切换迁移案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E6%89%A9%E5%AE%B9"><span class="nav-text">集群扩容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E7%BC%A9%E5%AE%B9"><span class="nav-text">集群缩容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E5%92%8CCRC16%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90"><span class="nav-text">集群常用操作和CRC16算法分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SpringBoot%E6%95%B4%E5%90%88Redis"><span class="nav-text">SpringBoot整合Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E4%BD%93%E6%A6%82%E8%BF%B0"><span class="nav-text">总体概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E6%88%90jedis"><span class="nav-text">集成jedis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E6%88%90lettuce"><span class="nav-text">集成lettuce</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E6%88%90RedisTemplate%E9%9B%86%E6%88%90"><span class="nav-text">集成RedisTemplate集成</span></a></li></ol></li></ol></div></div></div></div></div></div><div class="main-content-footer"><footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color"><div class="info-container py-3 text-center"><div class="text-center">&copy; <span>2022</span> - 2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration:0.5s;color:#f54545"></i>&nbsp;&nbsp;<a href="/">布鸽不鸽</a><p class="post-count space-x-0.5"><span>共撰写了 49 篇文章 </span><span>共 159k 字</span></p></div><script data-swup-reload-script src="https://cn.vercount.one/js"></script><div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right"><span id="busuanzi_container_site_uv" class="lg:!block"><span class="text-sm">访问人数</span> <span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" class="lg:!block"><span class="text-sm">总访问量</span> <span id="busuanzi_value_site_pv"></span></span></div><div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left"><span class="lg:block text-sm">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> 驱动</span> <span class="text-sm lg:block">主题&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.7.2</a></span></div><div>博客已运行 <span class="odometer" id="runtime_days"></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒</div><script data-swup-reload-script>try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}</script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="article-tools-list"><li class="right-bottom-tools page-aside-toggle"><i class="fa-regular fa-outdent"></i></li><li class="go-comment"><i class="fa-regular fa-comments"></i></li></ul></div></div><div class="right-side-tools-container"><div class="side-tools-container"><ul class="hidden-tools-list"><li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-plus"></i></li><li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-minus"></i></li><li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center"><i class="fa-regular fa-moon"></i></li><li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center"><i class="fa-regular fa-arrow-down"></i></li></ul><ul class="visible-tools-list"><li class="right-bottom-tools toggle-tools-list flex justify-center items-center"><i class="fa-regular fa-cog fa-spin"></i></li><li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="image-viewer-container"><img src=""></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fa-solid fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="站内搜索您需要的内容..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa-solid fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/libs/Swup.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/libs/SwupSlideTheme.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/libs/SwupScriptsPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/libs/SwupProgressPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/libs/SwupScrollPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/libs/SwupPreloadPlugin.min.js"></script><script>const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });</script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/tools/imageViewer.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/utils.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/main.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/layouts/navbarShrink.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/tools/scrollTopBottom.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/tools/lightDarkSwitch.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/layouts/categoryList.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/tools/localSearch.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/tools/codeBlock.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/layouts/lazyload.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/tools/runtime.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/libs/odometer.min.js"></script><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/assets/odometer-theme-minimal.css"><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/libs/Typed.min.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/plugins/typed.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/libs/mermaid.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/plugins/mermaid.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/tools/tocToggle.js" data-swup-reload-script></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/layouts/toc.js" data-swup-reload-script></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/plugins/tabs.js" data-swup-reload-script></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/libs/moment-with-locales.min.js" data-swup-reload-script></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/layouts/essays.js" data-swup-reload-script></script><div id="aplayer"></div><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/libs/APlayer.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.7.2/source/js/plugins/aplayer.js"></script></body></html>